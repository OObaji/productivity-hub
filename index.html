<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyndArc - Your Productivity Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 220px;
            max-height: 250px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 250px;
            }
        }
        .task-checkbox:checked + label span:first-child {
            background-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5; /* indigo-600 */
        }
        .task-checkbox:checked + label span:first-child svg {
            display: block;
        }
        .task-checkbox:checked + label {
            text-decoration: line-through;
            color: #6b7280; /* gray-500 */
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .landing-page {
            position: relative;
            background-color: #f0f4f8;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        #landing-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        .hidden-fade {
            opacity: 0;
            visibility: hidden;
            display: none;
        }
        .visible-fade {
            opacity: 1;
            visibility: visible;
            display: flex; /* Changed for main layout */
        }
        .page-view {
            display: none;
        }
        .page-view.active {
            display: block;
        }
        .kanban-board {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 1rem;
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .kanban-board::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
        .kanban-column {
            flex: 1 0 300px;
        }
        .kanban-card {
            box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06);
        }
        .sidebar-link.active {
            background-color: #374151; /* gray-700 */
            color: white;
        }
        .sidebar-topics-submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .task-board {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .task-column {
        }
        .task-item {
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
        }
        .task-item-checkbox:checked + label {
            text-decoration: line-through;
            color: #6b7280;
        }
        
        #pomodoro.page-view, #shift-timer.page-view, #idea-board.page-view, #mindfulness.page-view {
            background-size: cover;
            background-position: center;
            transition: background-color 0.5s ease-in-out, background-image 0.5s ease-in-out;
        }
        .overlay {
            background-color: rgba(0,0,0,0.5);
        }
        #pomodoro-timer-container {
            width: 320px;
            height: 320px;
            position: relative;
        }
        #pomodoro-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #pomodoro-controls {
            position: relative;
            z-index: 10;
        }
        input[type="datetime-local"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #shift-timer-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        #idea-board {
            background-image: url('https://www.transparenttextures.com/patterns/cork-wallet.png');
            background-color: #d2b48c;
        }
        .sticky-note {
            box-shadow: 5px 5px 7px rgba(33,33,33,.7);
            transition: transform .15s linear;
            cursor: grab;
            resize: both;
            overflow: hidden;
        }
        .sticky-note.dragging {
            transform: scale(1.05);
            z-index: 50;
            cursor: grabbing;
        }
        #add-note-btn {
            cursor: grab;
        }
        #add-note-btn:active {
            cursor: grabbing;
        }
        .breach-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb; /* gray-200 */
        }
        .dark .breach-item {
            border-bottom-color: #374151; /* gray-700 */
        }
        .breach-item:last-child {
            border-bottom: none;
        }
        .breach-item-checkbox:checked ~ .item-content .item-text {
            text-decoration: line-through;
            color: #6b7280; /* gray-500 */
        }
        .breach-item-checkbox:checked ~ label span {
             background-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5; /* indigo-600 */
        }
        .breach-item-checkbox:checked ~ label span svg {
            display: block;
        }
        /* Accordion for breach log */
        .log-container details > summary {
            list-style: none;
            cursor: pointer;
        }
        .log-container details > summary::-webkit-details-marker {
            display: none;
        }
        .log-container details .summary-arrow {
            transition: transform 0.2s;
        }
        .log-container details[open] .summary-arrow {
            transform: rotate(90deg);
        }
        /* General collapsible <details> styling */
        details > summary {
            list-style: none; /* Remove default marker */
            cursor: pointer;
        }
        details > summary::-webkit-details-marker {
            display: none; /* Remove default marker for Safari */
        }

        /* Toggle lock icons for the completed tasks dropdown */
        #breach-list-completed-section details > summary .lock-open {
            display: none;
        }
        #breach-list-completed-section details[open] > summary .lock-closed {
            display: none;
        }
        #breach-list-completed-section details[open] > summary .lock-open {
            display: inline;
        }

        /* Mindfulness styles */
        #mindfulness {
            background-image: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%);
        }
        .dark #mindfulness {
            background-image: linear-gradient(to top, #30cfd0 0%, #330867 100%);
        }
        #breathing-visualizer {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            transition: transform 4s ease-in-out;
            position: relative;
        }
        #breathing-visualizer.breathing {
            animation: breathe 10s ease-in-out infinite;
        }
        @keyframes breathe {
            0% { transform: scale(1); } /* Start */
            40% { transform: scale(1.3); } /* Inhale (4s) */
            60% { transform: scale(1.3); } /* Hold (2s) */
            100% { transform: scale(1); } /* Exhale (4s) */
        }
        .scenario-btn.selected {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            border-color: #4f46e5;
        }
        .breach-report-box {
            font-family: 'Times New Roman', Times, serif;
            font-size: 9pt;
            line-height: 1.2;
        }
        /* Ball Game Specific Styles */
        #ball-game-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            padding: 1rem;
            box-sizing: border-box;
            background-color: #1a1a2e; /* Dark theme for the game */
        }
        #game-canvas {
            background-color: #0d0d1a;
            border: 2px solid #5d5d81;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        #game-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        #game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            color: #fff;
            font-family: 'Inter', sans-serif;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-gray-900 text-slate-800 dark:text-slate-200">

    <!-- Generic Alert Modal -->
    <div id="alert-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-sm text-center">
            <p id="alert-message" class="text-lg text-slate-800 dark:text-slate-200 mb-6"></p>
            <button id="alert-close-btn" class="w-full px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75">OK</button>
        </div>
    </div>

    <!-- Principle Details Modal -->
    <div id="principle-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-lg text-left relative transform scale-95 transition-transform duration-300">
            <button id="principle-modal-close-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 id="principle-modal-title" class="text-2xl font-bold text-slate-900 dark:text-white mb-4"></h2>
            <p id="principle-modal-description" class="text-slate-600 dark:text-slate-400 mb-6"></p>
            <div id="principle-modal-tasks" class="max-h-60 overflow-y-auto pr-2"></div>
            <button id="principle-modal-ok-btn" class="mt-6 w-full px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75">Got it!</button>
        </div>
    </div>

    <!-- Overtime Edit Modal -->
    <div id="overtime-edit-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md space-y-4">
            <h2 class="text-xl font-bold text-slate-900 dark:text-white">Edit Overtime Entry</h2>
            <input type="hidden" id="edit-overtime-id">
            <div>
                <label for="edit-overtime-date" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Date</label>
                <input type="date" id="edit-overtime-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            </div>
            <div>
                <label for="edit-overtime-hours" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Hours Completed</label>
                <input type="number" id="edit-overtime-hours" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            </div>
             <div>
                <label for="edit-overtime-rate" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Rate per Hour (¬£)</label>
                <input type="number" id="edit-overtime-rate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            </div>
            <div>
                <label for="edit-overtime-allocation" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Allocation</label>
                <select id="edit-overtime-allocation" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option>Savings</option>
                    <option>Holiday</option>
                    <option value="Other">Other (Specify)</option>
                </select>
                <input type="text" id="edit-overtime-allocation-custom" class="mt-2 hidden block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Custom allocation name">
            </div>
            <div class="flex justify-end gap-4">
                <button id="cancel-edit-overtime-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-slate-800 dark:text-slate-200 font-semibold rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500">Cancel</button>
                <button id="save-edit-overtime-btn" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700">Save Changes</button>
            </div>
        </div>
    </div>


    <section id="landing-page" class="landing-page h-screen w-full flex items-center justify-center text-center p-4">
        <canvas id="landing-canvas"></canvas>
        <div class="relative z-10 max-w-3xl">
            <h1 class="text-5xl md:text-7xl font-bold text-slate-900 tracking-tight">Find Your Focus.</h1>
            <p class="mt-4 text-lg text-slate-600">A central hub for all your tasks, goals, and learning. Organize your life and achieve more, one day at a time.</p>
            <button id="get-started-btn" class="mt-8 px-8 py-4 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transform hover:scale-105 transition-transform duration-200">
                Enter Hub
            </button>
        </div>
    </section>

    <div id="app-layout" class="hidden-fade h-screen">
        <!-- Sidebar -->
        <nav id="sidebar" class="w-64 bg-gray-800 text-gray-300 flex-shrink-0 flex-col h-full p-4 fixed lg:relative lg:flex z-20 -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center mr-3">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                    </div>
                    <span class="font-bold text-xl text-white">Productivity Hub</span>
                </div>
                <button id="close-sidebar-btn" class="lg:hidden">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>

            <div id="user-info-container" class="text-sm text-center mb-4 p-2 rounded-lg bg-gray-700 overflow-hidden text-ellipsis whitespace-nowrap hidden">
                <span class="text-xs text-gray-400">Your ID:</span>
                <span id="user-id-display" class="font-mono break-all text-xs"></span>
                <p class="text-xs text-gray-400">Share with a friend to collaborate!</p>
            </div>

            <div class="flex-grow overflow-y-auto">
                <a href="#" class="sidebar-link nav-link flex items-center p-2 rounded-lg hover:bg-gray-700 active" data-view="dashboard-home">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                    Dashboard
                </a>
                
                <div class="mt-2">
                    <button id="topics-toggle-btn" class="sidebar-link w-full flex items-center p-2 rounded-lg hover:bg-gray-700">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707m-9.192 9.192l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                        Core Principles
                        <svg id="topics-arrow" class="w-4 h-4 ml-auto transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="topics-submenu" class="sidebar-topics-submenu pl-8 mt-1 space-y-1">
                        <a href="#" class="block text-sm p-1 rounded hover:bg-gray-700 topic-filter" data-module="all">All Principles</a>
                        <a href="#" class="block text-sm p-1 rounded hover:bg-gray-700 topic-filter" data-module="Ikigai (Áîü„ÅçÁî≤Êñê)">Ikigai (Áîü„ÅçÁî≤Êñê)</a>
                        <a href="#" class="block text-sm p-1 rounded hover:bg-gray-700 topic-filter" data-module="Eisenhower Matrix">Eisenhower Matrix</a>
                        <a href="#" class="block text-sm p-1 rounded hover:bg-gray-700 topic-filter" data-module="Pareto Principle (80/20)">Pareto Principle (80/20)</a>
                        <a href="#" class="nav-link block text-sm p-1 rounded hover:bg-gray-700" data-view="pomodoro">Pomodoro Technique</a>
                    </div>
                </div>

                <a href="#" class="sidebar-link nav-link flex items-center p-2 mt-2 rounded-lg hover:bg-gray-700" data-view="pomodoro">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    Pomodoro Timer
                </a>
                <a href="#" class="sidebar-link nav-link flex items-center p-2 mt-2 rounded-lg hover:bg-gray-700" data-view="mindfulness">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v5a3 3 0 003 3h2a3 3 0 003-3v-5m-8 0a5 5 0 1110 0m-5-9a5 5 0 110 10 5 5 0 010-10z"></path></svg>
                    Mindfulness
                </a>
                <a href="#" class="sidebar-link nav-link flex items-center p-2 mt-2 rounded-lg hover:bg-gray-700" data-view="shift-timer">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Shift Timer
                </a>
                <a href="#" class="sidebar-link nav-link flex items-center p-2 mt-2 rounded-lg hover:bg-gray-700" data-view="breach-list">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                    Breach List
                </a>
                <div class="mt-2">
                    <button id="tools-toggle-btn" class="sidebar-link w-full flex items-center p-2 rounded-lg hover:bg-gray-700">
                       <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                        Tools
                        <svg id="tools-arrow" class="w-4 h-4 ml-auto transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="tools-submenu" class="sidebar-topics-submenu pl-8 mt-1 space-y-1">
                        <a href="#" class="nav-link flex items-center p-1 rounded-lg hover:bg-gray-700" data-view="hour-calculator">
                           <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                            Hour Calculator
                        </a>
                        <a href="#" class="nav-link flex items-center p-1 rounded-lg hover:bg-gray-700" data-view="idea-board">
                           <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707m-9.192 9.192l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                            Idea Board
                        </a>
                        <a href="#" class="nav-link flex items-center p-1 rounded-lg hover:bg-gray-700" data-view="salary-calculator">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 8h6m-5 4h.01M18 12a6 6 0 11-12 0 6 6 0 0112 0z"></path></svg>
                             Salary Calculator
                         </a>
                         <a href="#" class="nav-link flex items-center p-1 rounded-lg hover:bg-gray-700" data-view="overtime-tracker">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6a2 2 0 100-4 2 2 0 000 4zm0 12a2 2 0 100 4 2 2 0 000-4zm0 0v-.01M12 18v-1m0-8a2 2 0 11-4 0 2 2 0 014 0zm0 0h.01M6 12a2 2 0 11-4 0 2 2 0 014 0zm0 0H5m14 0a2 2 0 11-4 0 2 2 0 014 0zm0 0h-.01M18 12h-1m-4-4a2 2 0 110-4 2 2 0 010 4zm0 0v.01M12 8V7m0 1v.01"></path></svg>
                             Overtime Tracker
                         </a>
                         <a href="#" class="nav-link flex items-center p-1 rounded-lg hover:bg-gray-700" data-view="ball-game">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.125l-3.376 3.376m0 0l-3.376-3.376m3.376 3.376v-7.25m6.876 7.25c.571 0 1.034-.463 1.034-1.034v-1.258c0-.571-.463-1.034-1.034-1.034s-1.034.463-1.034 1.034v1.258c0 .571.463 1.034 1.034 1.034zM12 21a9 9 0 100-18 9 9 0 000 18z"></path></svg>
                            Ball Game
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 pt-4">
                 <a href="#" class="sidebar-link nav-link flex items-center p-2 rounded-lg hover:bg-gray-700" data-view="settings">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    Settings
                </a>
                 <a href="#" id="logout-btn" class="sidebar-link flex items-center p-2 mt-2 rounded-lg hover:bg-gray-700">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                    Log Out
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main id="main-container" class="flex-1 h-full overflow-y-auto bg-slate-50 dark:bg-gray-800">
             <header class="p-4 bg-white dark:bg-gray-800 shadow-md lg:hidden flex justify-between items-center sticky top-0 z-10">
                <span class="font-bold text-xl text-indigo-600">Productivity Hub</span>
                <button id="open-sidebar-btn">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </header>
            <div id="main-content-wrapper" class="h-full">
                <div id="dashboard-home" class="page-view active container mx-auto px-4 sm:px-6 py-8">
                    <header class="text-center mb-8">
                        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white">Productivity Dashboard</h1>
                        <p class="mt-2 text-slate-600 dark:text-slate-400">Your interactive guide to productivity principles and task management.</p>
                    </header>
                    
                    <section id="time-weather-section" class="mb-8 p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm flex flex-col md:flex-row justify-between items-center">
                        <div class="text-center md:text-left">
                            <p id="time-display" class="text-4xl font-bold text-indigo-600 dark:text-indigo-400">12:00:00 PM</p>
                            <p id="date-display" class="text-slate-500 dark:text-slate-400">Thursday, July 10, 2025</p>
                        </div>
                        <div id="weather-display" class="text-center md:text-right mt-4 md:mt-0 flex items-center gap-4">
                            <!-- Weather data will be injected here -->
                        </div>
                    </section>

                    <section id="daily-quote-section" class="mb-8 p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm text-center">
                        <h2 class="text-xl font-bold text-slate-800 dark:text-white mb-4">Quote of the Day</h2>
                        <blockquote class="text-lg italic text-slate-600 dark:text-slate-400">
                            <p id="quote-text">"The secret of getting ahead is getting started."</p>
                            <cite id="quote-author" class="block mt-2 not-italic font-semibold text-slate-500">- Mark Twain</cite>
                        </blockquote>
                    </section>

                    <!-- Dashboard Metrics Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                        <section id="breach-stats-card" class="p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm flex flex-col">
                            <h2 class="text-xl font-bold text-slate-800 dark:text-white mb-4 text-center">Breach List Stats</h2>
                            <div class="flex-grow flex flex-col justify-center space-y-4">
                                <div class="flex justify-between text-sm">
                                    <span>Total</span>
                                    <span id="breach-stats-total" class="font-semibold">0</span>
                                </div>
                                <div class="flex justify-between text-sm text-green-500">
                                    <span>Completed</span>
                                    <span id="breach-stats-completed" class="font-semibold">0</span>
                                </div>
                                <div class="flex justify-between text-sm text-red-500">
                                    <span>Pending</span>
                                    <span id="breach-stats-pending" class="font-semibold">0</span>
                                </div>
                                <div class="pt-2">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-semibold text-slate-700 dark:text-slate-300 text-sm">Completion Rate</span>
                                        <span id="breach-stats-progress-percent" class="font-semibold text-indigo-600 dark:text-indigo-400 text-sm">0%</span>
                                    </div>
                                    <div class="w-full bg-slate-200 dark:bg-gray-700 rounded-full h-2">
                                        <div id="breach-stats-progress-bar" class="bg-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section class="p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm flex flex-col">
                            <h2 class="text-xl font-bold text-slate-800 dark:text-white mb-4 text-center">Daily Breach Completions</h2>
                            <div id="breach-log-container" class="log-container flex-grow h-[250px] overflow-y-auto space-y-2">
                                <!-- Accordion items will be injected here -->
                            </div>
                        </section>
                    </div>

                    <main id="curriculum-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
                    </main>
                </div>

                <div id="pomodoro" class="page-view h-full">
                    <div class="overlay flex flex-col items-center justify-center h-full p-4 text-white">
                        <div class="w-full max-w-md bg-white/10 backdrop-blur-md p-6 rounded-2xl mb-6">
                            <label for="focus-task-input" class="text-sm font-medium text-gray-300">What is your main focus?</label>
                            <input id="focus-task-input" type="text" placeholder="e.g., Finish chapter on Neural Networks" class="w-full bg-transparent border-b-2 border-gray-400 focus:border-white focus:outline-none py-2 mt-1 text-lg">
                        </div>
                        <div id="pomodoro-timer-container" class="bg-white/10 backdrop-blur-md rounded-full p-6 flex flex-col items-center justify-between shadow-2xl">
                            <div class="relative flex items-center justify-center w-full h-full">
                                <canvas id="pomodoro-canvas" class="absolute top-0 left-0" width="270" height="270"></canvas>
                                <div id="pomodoro-controls" class="absolute flex flex-col items-center">
                                    <span id="pomodoro-icon" class="text-4xl">üçÖ</span>
                                    <div id="pomodoro-time" class="text-6xl font-bold my-1">25:00</div>
                                    <div id="pomodoro-mode" class="text-lg tracking-widest uppercase">Focus</div>
                                    <button id="pomodoro-play-pause" class="mt-2">
                                        <svg id="play-icon" class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20"><path d="M4.018 15.59a.5.5 0 00.816.372l10-7a.5.5 0 000-.744l-10-7A.5.5 0 004 2v13.59z" /></svg>
                                        <svg id="pause-icon" class="w-12 h-12 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M5.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75A.75.75 0 007.25 3h-1.5zM12.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75h-1.5z" /></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4 mt-6">
                            <button id="pomodoro-switch-mode" class="px-8 py-3 bg-white/20 backdrop-blur-md rounded-full font-semibold uppercase tracking-wider">Take a Break</button>
                            <div class="text-center">
                                <div id="pomodoro-session-count" class="text-2xl font-bold">0</div>
                                <div class="text-sm">Sessions</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="mindfulness" class="page-view h-full">
                    <div class="flex flex-col items-center justify-center h-full p-4 text-white text-center">
                        <h1 class="text-4xl font-bold mb-2" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.2)">Mindful Breathing</h1>
                        <p class="mb-8 max-w-md" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.2)">Take a moment to center yourself. Follow the guide below to regulate your breathing and find your calm.</p>

                        <div id="breathing-visualizer" class="flex items-center justify-center mb-6">
                            <span id="breathing-instruction" class="text-2xl font-semibold text-white/80 transition-opacity duration-500">Ready?</span>
                        </div>

                        <div id="mindfulness-controls" class="w-full max-w-sm bg-white/10 backdrop-blur-md p-6 rounded-2xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <label for="mindfulness-duration" class="font-medium">Session Length:</label>
                                <select id="mindfulness-duration" class="bg-white/20 rounded p-2">
                                    <option value="60">1 Minute</option>
                                    <option value="180">3 Minutes</option>
                                    <option value="300">5 Minutes</option>
                                </select>
                            </div>
                            <button id="mindfulness-start-btn" class="w-full px-8 py-3 bg-white/80 text-indigo-700 font-bold rounded-lg shadow-md hover:bg-white transition-colors">
                                Start Session
                            </button>
                        </div>

                        <div class="mt-6 text-center">
                            <div id="mindfulness-session-count" class="text-2xl font-bold">0</div>
                            <div class="text-sm">Sessions Completed</div>
                        </div>
                    </div>
                </div>

                <div id="shift-timer" class="page-view h-full relative">
                    <canvas id="shift-timer-canvas" class="absolute top-0 left-0 w-full h-full"></canvas>
                    <div class="relative z-10 flex flex-col items-center justify-center h-full text-white overflow-y-auto">
                        <div id="shift-setup" class="w-full max-w-md bg-black/40 backdrop-blur-md p-8 rounded-2xl text-center my-8 shadow-2xl border border-white/10">
                            <h2 class="text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-300">Shift Setup</h2>
                             <div class="space-y-5">
                                <div class="text-left">
                                    <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">Shift Name</label>
                                    <input type="text" id="shift-title-input" placeholder="e.g., Night Shift Grind" value="Let's get this bread!" class="w-full p-3 rounded-xl bg-gray-800/50 text-white border border-gray-600 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all">
                                </div>
                                <div class="text-left">
                                    <label for="shift-end-time-input" class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">End Time</label>
                                    <input type="datetime-local" id="shift-end-time-input" class="w-full p-3 rounded-xl bg-gray-800/50 text-white border border-gray-600 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all">
                                </div>
                                <div class="grid grid-cols-2 gap-3 text-sm">
                                    <button id="preset-normal-btn" class="p-3 bg-indigo-600/30 hover:bg-indigo-600/50 border border-indigo-500/30 rounded-xl transition-all">Normal (7AM)</button>
                                    <button id="preset-overtime-btn" class="p-3 bg-purple-600/30 hover:bg-purple-600/50 border border-purple-500/30 rounded-xl transition-all">Overtime (5AM)</button>
                                </div>
                                
                                <div class="bg-gray-800/40 p-5 rounded-xl border border-gray-700">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="font-bold text-gray-200">Breaks</h3>
                                        <div class="flex gap-2">
                                            <button id="load-my-breaks-btn" class="text-xs px-2 py-1 bg-blue-600/30 hover:bg-blue-600/50 text-blue-200 rounded border border-blue-500/30 transition-all">Load My Defaults</button>
                                            <button id="add-break-btn" class="text-xs px-2 py-1 bg-green-600/30 hover:bg-green-600/50 text-green-200 rounded border border-green-500/30 transition-all">+ Add</button>
                                        </div>
                                    </div>
                                    <div id="break-times-container" class="space-y-2 max-h-40 overflow-y-auto pr-1 custom-scrollbar">
                                        <!-- Break times will be added here -->
                                    </div>
                                    <div class="mt-4 pt-4 border-t border-gray-700 flex items-center justify-between">
                                        <div class="text-left">
                                            <label for="health-breaks-toggle" class="text-sm font-medium text-gray-300 cursor-pointer select-none">Auto-schedule Health Breaks</label>
                                            <p class="text-[10px] text-gray-500">Adds a 5m walk break every hour if no break exists.</p>
                                        </div>
                                        <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                            <input type="checkbox" name="health-breaks-toggle" id="health-breaks-toggle" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer checked:right-0 right-5 checked:border-green-400"/>
                                            <label for="health-breaks-toggle" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-600 cursor-pointer"></label>
                                        </div>
                                    </div>
                                </div>
                             </div>
                            <button id="start-shift-btn" class="mt-8 w-full px-8 py-4 bg-gradient-to-r from-yellow-500 to-orange-500 text-gray-900 font-bold text-lg rounded-xl shadow-lg hover:shadow-orange-500/20 hover:scale-[1.02] transition-all transform">Start Shift</button>
                        </div>

                        <div id="shift-countdown-display" class="hidden text-center w-full max-w-6xl px-4 flex flex-col h-full py-8">
                            <!-- Header / Quote -->
                            <div class="flex-none mb-4">
                                <h2 id="shift-motivation-quote" class="text-2xl md:text-3xl font-semibold tracking-wide text-gray-100">Let's get this bread!</h2>
                                <div id="break-alert-banner" class="hidden mt-2 py-2 px-6 bg-green-500/20 border border-green-500 text-green-300 rounded-full inline-block animate-pulse">
                                    üå± Time to step away from the desk!
                                </div>
                            </div>

                            <!-- Main Timer -->
                            <div class="flex-grow flex flex-col justify-center">
                                <div class="flex items-center justify-center my-4 text-white drop-shadow-[0_0_15px_rgba(220,38,38,0.5)] scale-90 md:scale-100">
                                    <div class="mx-2 text-center">
                                        <div id="shift-hours-display" class="text-6xl sm:text-8xl md:text-9xl font-bold font-mono">00</div>
                                        <div class="text-xs sm:text-sm uppercase tracking-[0.3em] text-red-400 font-bold mt-2">Hours</div>
                                    </div>
                                    <div class="text-6xl sm:text-8xl md:text-9xl font-bold text-gray-600 pb-8">:</div>
                                    <div class="mx-2 text-center">
                                        <div id="shift-minutes-display" class="text-6xl sm:text-8xl md:text-9xl font-bold font-mono">00</div>
                                        <div class="text-xs sm:text-sm uppercase tracking-[0.3em] text-red-400 font-bold mt-2">Minutes</div>
                                    </div>
                                    <div class="text-6xl sm:text-8xl md:text-9xl font-bold text-gray-600 pb-8">:</div>
                                    <div class="mx-2 text-center">
                                        <div id="shift-seconds-display" class="text-6xl sm:text-8xl md:text-9xl font-bold font-mono">00</div>
                                        <div class="text-xs sm:text-sm uppercase tracking-[0.3em] text-red-400 font-bold mt-2">Seconds</div>
                                    </div>
                                </div>
                                
                                <!-- Next Break Info -->
                                <div id="next-break-container" class="mt-8 text-center transition-opacity duration-500">
                                    <div class="inline-flex flex-col items-center bg-gray-800/50 backdrop-blur-sm border border-gray-600 rounded-2xl px-8 py-4">
                                        <span class="text-gray-400 text-xs uppercase tracking-widest mb-1">Next Break In</span>
                                        <span id="time-to-next-break" class="text-3xl font-bold text-white font-mono">00:00:00</span>
                                        <span id="next-break-time-label" class="text-indigo-300 text-sm mt-1 font-medium">at 22:00</span>
                                    </div>
                                </div>

                                <!-- Break Active Mode (Replaces Timer when active) -->
                                <div id="break-active-display" class="hidden absolute inset-0 z-50 bg-black/80 backdrop-blur-xl flex flex-col items-center justify-center p-8">
                                    <div class="w-32 h-32 bg-green-500/20 rounded-full flex items-center justify-center mb-6 animate-bounce">
                                        <span class="text-6xl">‚òï</span>
                                    </div>
                                    <h2 class="text-5xl font-bold text-white mb-2">Break Time!</h2>
                                    <p class="text-xl text-green-300 mb-8">Go for a walk. Get some water. Step away.</p>
                                    <div class="text-8xl font-bold font-mono text-white mb-4" id="break-timer-large">10:00</div>
                                    <p class="text-gray-400">Time remaining until work resumes</p>
                                </div>
                            </div>
                            
                            <!-- Visual Progress Blocks -->
                            <div class="flex-none mt-auto mb-8 w-full">
                                <div class="flex justify-between text-xs text-gray-400 font-mono tracking-tight px-1 uppercase mb-2">
                                    <span id="shift-start-time-label">Start</span>
                                    <span class="flex-grow text-center text-gray-500 text-[10px]">Shift Progress</span>
                                    <span id="shift-end-time-label">End</span>
                                </div>
                                
                                <div id="shift-blocks-container" class="relative w-full h-20 bg-gray-900 rounded-xl border-2 border-gray-700 shadow-xl overflow-hidden flex">
                                    <!-- Blocks generated by JS -->
                                </div>
                                
                                <button id="reset-shift-btn" class="mt-8 text-xs text-red-400 hover:text-white hover:underline transition-all opacity-50 hover:opacity-100">Reset / End Shift Early</button>
                            </div>
                        </div>
                        
                        <div id="shift-end-message" class="hidden text-center max-w-lg z-50 bg-black/60 p-12 rounded-3xl backdrop-blur-xl border border-white/10 shadow-2xl">
                            <h2 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-600 mb-6">Shift Complete!</h2>
                            <p class="text-xl text-gray-300 mb-8 leading-relaxed">You've crushed it. Time to rest and recharge.</p>
                            <div class="flex justify-center gap-4">
                                <button id="new-shift-btn" class="px-8 py-3 bg-white text-gray-900 font-bold rounded-xl hover:bg-gray-200 transition-colors">New Shift</button>
                            </div>
                        </div>
                    </div>
                </div>

                 <div id="hour-calculator" class="page-view container mx-auto px-4 sm:px-6 py-8">
                    <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-4">Hour Calculator</h1>
                    <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm">
                            <h2 class="text-lg font-semibold text-white bg-blue-600 -mx-6 -mt-6 mb-6 px-6 py-3 rounded-t-lg">Enter Time:</h2>
                            <div id="time-entries" class="space-y-2">
                                <!-- Time entries will be generated here -->
                            </div>
                            <button id="add-time-row" class="mt-4 text-blue-600 dark:text-blue-400 hover:underline text-sm font-semibold">+ Add More Lines</button>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm">
                            <h2 class="text-lg font-semibold text-white bg-blue-600 -mx-6 -mt-6 mb-6 px-6 py-3 rounded-t-lg">See Your Total:</h2>
                             <div class="space-y-4">
                                <div class="bg-gray-200 dark:bg-gray-700 p-4 rounded-lg text-center">
                                    <div id="total-time-hms" class="text-3xl font-bold text-gray-800 dark:text-white">00:00:00</div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">HH:MM:SS</div>
                                </div>
                                <div class="bg-gray-200 dark:bg-gray-700 p-4 rounded-lg text-center">
                                    <div id="total-time-decimal" class="text-3xl font-bold text-gray-800 dark:text-white">0.00</div>
                                     <div class="text-sm text-gray-500 dark:text-gray-400">In Hours</div>
                                </div>
                                <button id="calculate-time-btn" class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">Calculate</button>
                                <button id="clear-time-btn" class="w-full py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700">Clear</button>
                                <button id="print-time-btn" class="w-full py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700">Print</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="settings" class="page-view container mx-auto px-4 sm:px-6 py-8">
                     <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-6">Settings</h1>
                     <div class="space-y-8 max-w-2xl mx-auto">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm">
                            <h2 class="text-xl font-semibold mb-4 border-b pb-2 dark:border-gray-700">Appearance</h2>
                            <div class="flex items-center justify-between">
                                <label for="dark-mode-toggle" class="font-medium text-slate-700 dark:text-slate-300">Dark Mode</label>
                                <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                                    <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                                    <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 100 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                                </button>
                            </div>
                        </div>
                     </div>
                </div>
                <div id="idea-board" class="page-view h-full relative overflow-hidden">
                    <div id="idea-board-container" class="w-full h-full"></div>
                    <button id="add-note-btn" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 px-6 py-3 bg-yellow-400 text-gray-800 font-semibold rounded-full shadow-lg hover:bg-yellow-500 z-20">
                        + Add Note
                    </button>
                </div>
                <div id="breach-list" class="page-view container mx-auto px-4 sm:px-6 py-8">
                    <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-6">Breach List</h1>
                    <!-- Daily Target -->
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6">
                        <label for="daily-target-input" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Set Daily Completion Target</label>
                        <div class="flex gap-4">
                            <input type="number" id="daily-target-input" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-slate-900 dark:text-white" value="20" min="1">
                            <button id="set-daily-target-btn" class="px-6 py-2 bg-indigo-600 text-white rounded-md font-semibold">Set</button>
                        </div>
                    </div>
                    <!-- Daily Target Progress -->
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-semibold text-slate-700 dark:text-slate-300">Today's Goal</span>
                            <span id="daily-breach-progress-text" class="font-semibold text-indigo-600 dark:text-indigo-400">0 / 20</span>
                        </div>
                        <div class="w-full bg-slate-200 dark:bg-gray-700 rounded-full h-2.5">
                            <div id="daily-breach-progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <!-- Counters -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm text-center">
                            <p class="text-sm text-slate-500 dark:text-slate-400">Total Items</p>
                            <p id="breach-total-count" class="text-2xl font-bold text-slate-900 dark:text-white">0</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm text-center">
                            <p class="text-sm text-slate-500 dark:text-slate-400">Completed</p>
                            <p id="breach-completed-count" class="text-2xl font-bold text-green-500">0</p>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm text-center">
                            <p class="text-sm text-slate-500 dark:text-slate-400">Uncompleted</p>
                            <p id="breach-uncompleted-count" class="text-2xl font-bold text-red-500">0</p>
                        </div>
                    </div>
                    <!-- Add Item Form -->
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-6">
                        <div class="flex gap-4">
                            <input type="text" id="breach-item-input" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-slate-900 dark:text-white" placeholder="Add a new breach item...">
                            <button id="add-breach-item-btn" class="px-6 py-2 bg-indigo-600 text-white rounded-md font-semibold">Add</button>
                        </div>
                    </div>
                    <!-- Uncompleted Items -->
                    <div id="breach-list-uncompleted-container" class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm space-y-2">
                        <!-- Items will be generated by JS -->
                    </div>
                    <!-- Completed Items Section -->
                    <div id="breach-list-completed-section" class="mt-6 hidden">
                        <details class="bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden">
                            <summary class="p-4 cursor-pointer flex justify-between items-center font-semibold text-slate-800 dark:text-white">
                                <div class="flex items-center">
                                    <span class="lock-icon-container mr-2">
                                        <svg class="w-5 h-5 text-slate-500 lock-closed" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                                        <svg class="w-5 h-5 text-slate-500 lock-open" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"></path></svg>
                                    </span>
                                    <span>Completed Items</span>
                                </div>
                                <span id="completed-tasks-count" class="text-sm px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300 rounded-full font-medium">0</span>
                            </summary>
                            <div id="breach-list-completed-container" class="p-4 border-t border-slate-200 dark:border-gray-700 space-y-2">
                                <!-- Completed items will be generated here -->
                            </div>
                        </details>
                    </div>
                </div>
                <div id="salary-calculator" class="page-view container mx-auto px-4 sm:px-6 py-8">
                    <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-6">Salary Calculator (UK 2024/25)</h1>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Input Section -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">I know my...</label>
                                <div class="flex gap-4">
                                    <label class="flex items-center">
                                        <input type="radio" name="income-type" value="annual" class="form-radio text-indigo-600" checked>
                                        <span class="ml-2 text-slate-800 dark:text-slate-200">Gross Annual Salary</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="income-type" value="monthly" class="form-radio text-indigo-600">
                                        <span class="ml-2 text-slate-800 dark:text-slate-200">Gross Monthly Salary</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label for="gross-income" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Gross Income (¬£)</label>
                                <input type="number" id="gross-income" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="e.g., 50000">
                            </div>
                             <div>
                                <label for="tax-code" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Tax Code</label>
                                <input type="text" id="tax-code" value="1257L" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div>
                            <button id="calculate-salary-btn" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors">Calculate</button>
                        </div>
                        <!-- Output Section -->
                        <div id="salary-results" class="hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center mb-6">
                                <div class="bg-green-100 dark:bg-green-900/50 p-4 rounded-lg">
                                    <p class="text-sm text-green-800 dark:text-green-300">Annual Take-Home</p>
                                    <p id="annual-net" class="text-2xl font-bold text-green-900 dark:text-green-200">¬£0.00</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/50 p-4 rounded-lg">
                                    <p class="text-sm text-green-800 dark:text-green-300">Monthly Take-Home</p>
                                    <p id="monthly-net" class="text-2xl font-bold text-green-900 dark:text-green-200">¬£0.00</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <!-- Annual Breakdown -->
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm space-y-2">
                                    <h3 class="font-bold text-lg text-center text-slate-800 dark:text-white mb-2">Annual Breakdown</h3>
                                    <div class="flex justify-between text-sm border-b dark:border-gray-700 pb-1">
                                        <span class="text-slate-600 dark:text-slate-400">Gross Income:</span>
                                        <span id="annual-gross" class="font-medium text-slate-800 dark:text-slate-200">¬£0.00</span>
                                    </div>
                                    <div class="flex justify-between text-sm border-b dark:border-gray-700 pb-1">
                                        <span class="text-slate-600 dark:text-slate-400">Personal Allowance:</span>
                                        <span id="annual-allowance" class="font-medium text-slate-800 dark:text-slate-200">¬£0.00</span>
                                    </div>
                                    <div class="flex justify-between text-sm border-b dark:border-gray-700 pb-1">
                                        <span class="text-slate-600 dark:text-slate-400">Taxable Income:</span>
                                        <span id="annual-taxable" class="font-medium text-slate-800 dark:text-slate-200">¬£0.00</span>
                                    </div>
                                    <div class="flex justify-between text-sm border-b dark:border-gray-700 pb-1">
                                        <span class="text-slate-600 dark:text-slate-400">Income Tax:</span>
                                        <span id="annual-tax" class="font-medium text-red-600 dark:text-red-400">- ¬£0.00</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-slate-600 dark:text-slate-400">National Insurance:</span>
                                        <span id="annual-ni" class="font-medium text-red-600 dark:text-red-400">- ¬£0.00</span>
                                    </div>
                                </div>
                                <!-- Monthly Breakdown -->
                                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm space-y-2">
                                    <h3 class="font-bold text-lg text-center text-slate-800 dark:text-white mb-2">Monthly Breakdown</h3>
                                    <div class="flex justify-between text-sm border-b dark:border-gray-700 pb-1">
                                        <span class="text-slate-600 dark:text-slate-400">Gross Income:</span>
                                        <span id="monthly-gross" class="font-medium text-slate-800 dark:text-slate-200">¬£0.00</span>
                                    </div>
                                    <div class="flex justify-between text-sm border-b dark:border-gray-700 pb-1">
                                        <span class="text-slate-600 dark:text-slate-400">Personal Allowance:</span>
                                        <span id="monthly-allowance" class="font-medium text-slate-800 dark:text-slate-200">¬£0.00</span>
                                    </div>
                                    <div class="flex justify-between text-sm border-b dark:border-gray-700 pb-1">
                                        <span class="text-slate-600 dark:text-slate-400">Taxable Income:</span>
                                        <span id="monthly-taxable" class="font-medium text-slate-800 dark:text-slate-200">¬£0.00</span>
                                    </div>
                                    <div class="flex justify-between text-sm border-b dark:border-gray-700 pb-1">
                                        <span class="text-slate-600 dark:text-slate-400">Income Tax:</span>
                                        <span id="monthly-tax" class="font-medium text-red-600 dark:text-red-400">- ¬£0.00</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-slate-600 dark:text-slate-400">National Insurance:</span>
                                        <span id="monthly-ni" class="font-medium text-red-600 dark:text-red-400">- ¬£0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                 <div id="overtime-tracker" class="page-view container mx-auto px-4 sm:px-6 py-8">
                    <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-6">Overtime Tracker</h1>
                    <div id="overtime-fund-totals" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <!-- Totals will be generated here -->
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm mb-8">
                        <h2 class="text-xl font-semibold mb-4 text-slate-800 dark:text-white">Add New Overtime</h2>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                            <div>
                                <label for="overtime-date" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Date</label>
                                <input type="date" id="overtime-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div>
                            <div>
                                <label for="overtime-hours" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Hours</label>
                                <input type="number" id="overtime-hours" placeholder="e.g., 5.5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div>
                             <div>
                                <label for="overtime-rate" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Rate/hr (¬£)</label>
                                <input type="number" id="overtime-rate" placeholder="e.g., 15.00" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div>
                            <div class="flex-grow">
                                <label for="overtime-allocation" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Allocation</label>
                                <select id="overtime-allocation" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option>Savings</option>
                                    <option>Holiday</option>
                                    <option value="Other">Other (Specify)</option>
                                </select>
                                <input type="text" id="overtime-allocation-custom" class="mt-2 hidden w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Custom allocation name">
                            </div>
                            <button id="add-overtime-btn" class="w-full py-2 px-4 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors">Add Overtime</button>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm">
                        <h2 class="text-xl font-semibold mb-4 text-slate-800 dark:text-white">Overtime Log</h2>
                        <div id="overtime-list" class="space-y-4">
                           <!-- Entries will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
                <div id="ball-game" class="page-view h-full">
                    <div id="ball-game-container">
                        <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">Ball Game</h1>
                        <div id="game-info">
                            <span id="game-score">Score: 0</span>
                            <span id="game-lives">Lives: 3</span>
                            <span id="game-high-score">High Score: 0</span>
                        </div>
                        <canvas id="game-canvas" width="500" height="400"></canvas>
                        <div id="game-controls">
                            <button id="start-game-btn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700">Start</button>
                            <button id="reset-game-btn" class="px-6 py-2 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700">Reset</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        const curriculumData = [
            {
                module: "Ikigai (Áîü„ÅçÁî≤Êñê)",
                themeColor: "rose",
                icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />`,
                description: "DDiscover your 'reason for being' by finding the intersection of what you love, what you're good at, what the world needs, and what you can be paid for.",
                topics: [
                    { title: "Passion", items: ["What do you love?", "What are you good at?"] },
                    { title: "Mission", items: ["What does the world need?", "What can you contribute?"] },
                    { title: "Vocation & Profession", items: ["What can you be paid for?", "Synthesizing your Ikigai"] },
                ]
            },
            {
                module: "Eisenhower Matrix",
                themeColor: "blue",
                icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V7a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2z" />`,
                description: "Organize tasks by urgency and importance to prioritize effectively and eliminate time-wasting activities.",
                topics: [
                    { title: "Quadrant 1: Urgent & Important", items: ["Identify crises and deadlines", "Strategy: Do immediately"] },
                    { title: "Quadrant 2: Not Urgent & Important", items: ["Focus on long-term goals", "Strategy: Schedule and plan"] },
                    { title: "Quadrant 3: Urgent & Not Important", items: ["Minimize interruptions", "Strategy: Delegate if possible"] },
                    { title: "Quadrant 4: Not Urgent & Not Important", items: ["Recognize time-wasters", "Strategy: Eliminate or reduce"] },
                ]
            },
            {
                module: "Pareto Principle (80/20)",
                themeColor: "emerald",
                icon: `<path stroke-linecap="round" stroke-linejoin="round" d="M15.5,6.8l-3.6,9.5c-0.2,0.5-0.9,0.5-1.1,0L5.5,6.8C5.3,6.3,5.6,5.7,6.2,5.7h12.6C19.4,5.7,19.7,6.3,19.5,6.8z M12.5,18.8c0,0.6-0.4,1-1,1h-3c-0.6,0-1-0.4-1-1v-2.5h5V18.8z"/>`,
                description: "Focus on the 20% of activities that will yield 80% of the results, maximizing your effort and impact.",
                topics: [
                    { title: "Core Concept", items: ["Understanding the 80/20 ratio", "Separating the vital few from the trivial many"] },
                    { title: "Application", items: ["Analyze tasks and efforts", "Identify your high-impact activities", "Focus energy on the 20%"] },
                ]
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const getStartedBtn = document.getElementById('get-started-btn');
            const landingPage = document.getElementById('landing-page');
            const appLayout = document.getElementById('app-layout');
            const logoutBtn = document.getElementById('logout-btn');
            const openSidebarBtn = document.getElementById('open-sidebar-btn');
            const closeSidebarBtn = document.getElementById('close-sidebar-btn');
            const sidebar = document.getElementById('sidebar');
            const landingCanvas = document.getElementById('landing-canvas');
            
            const grid = document.getElementById('curriculum-grid');

            // Modal elements
            const alertModal = document.getElementById('alert-modal');
            const alertMessage = document.getElementById('alert-message');
            const alertCloseBtn = document.getElementById('alert-close-btn');

            let dashboardInitialized = false;

            // --- Generic Modal Functions ---
            function showAlert(message) {
                alertMessage.textContent = message;
                alertModal.classList.remove('hidden');
                alertModal.classList.add('flex');
            }

            function hideAlert() {
                alertModal.classList.add('hidden');
                alertModal.classList.remove('flex');
            }

            alertCloseBtn.addEventListener('click', hideAlert);
            // --- End Modal Functions ---

            function initializeDashboard() {
                if (dashboardInitialized) return;

                grid.innerHTML = ''; // Clear existing grid items

                curriculumData.forEach((moduleData) => {
                    const moduleCard = document.createElement('div');
                    moduleCard.className = `module-card bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 flex flex-col`;
                    moduleCard.dataset.module = moduleData.module;
                    
                    moduleCard.innerHTML = `
                        <div class="flex-grow">
                            <div class="w-12 h-12 rounded-lg bg-${moduleData.themeColor}-100 dark:bg-${moduleData.themeColor}-900/50 flex items-center justify-center mb-4">
                                <svg class="w-6 h-6 text-${moduleData.themeColor}-600 dark:text-${moduleData.themeColor}-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">${moduleData.icon}</svg>
                            </div>
                            <h3 class="text-xl font-bold text-slate-900 dark:text-white">${moduleData.module}</h3>
                            <p class="text-slate-600 dark:text-slate-400 mt-2 mb-4 h-24">${moduleData.description}</p>
                        </div>
                        <div class="mt-auto pt-4">
                            <button class="learn-more-btn w-full px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75"
                                data-module="${moduleData.module}"
                                data-description="${moduleData.description}"
                                data-topics='${JSON.stringify(moduleData.topics)}'>
                                Learn More
                            </button>
                        </div>
                    `;
                    grid.appendChild(moduleCard);
                });

                renderBreachCompletionTable(); 
                renderBreachStats();
                renderDailyBreachProgress();
                setupDailyQuote();
                setupTimeAndWeather();
                setupNavigation();
                setupPrincipleModals();
                setupPomodoro();
                setupMindfulness();
                setupShiftTimer();
                setupHourCalculator();
                setupIdeaBoard();
                setupSettings();
                setupBreachList();
                setupSalaryCalculator();
                setupOvertimeTracker();
                setupBallGame(); 
                dashboardInitialized = true;
            }
            
            getStartedBtn.addEventListener('click', () => {
                initializeDashboard();
                landingPage.style.display = 'none';
                appLayout.classList.remove('hidden-fade');
                appLayout.classList.add('visible-fade');
                localStorage.setItem('appEntered', 'true');
                navigateToView('dashboard-home');
            });

            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('appEntered');
                localStorage.removeItem('lastActiveView');
                appLayout.style.opacity = 0;
                setTimeout(() => {
                    appLayout.classList.add('hidden-fade');
                    appLayout.classList.remove('visible-fade');
                    
                    landingPage.style.display = 'flex';
                    setTimeout(() => {
                        landingPage.style.opacity = 1;
                    }, 50);
                }, 500);
            });

            function navigateToView(viewId) {
                const pageViews = document.querySelectorAll('.page-view');
                const sidebarLinks = document.querySelectorAll('.sidebar-link');
                const mainContentWrapper = document.getElementById('main-content-wrapper');

                pageViews.forEach(page => {
                    page.classList.toggle('active', page.id === viewId);
                });

                if (['pomodoro', 'shift-timer', 'idea-board', 'mindfulness', 'ball-game'].includes(viewId)) {
                    mainContentWrapper.classList.remove('container', 'mx-auto', 'px-4', 'sm:px-6', 'py-8');
                } else {
                    mainContentWrapper.classList.add('container', 'mx-auto', 'px-4', 'sm:px-6', 'py-8');
                }

                sidebarLinks.forEach(link => {
                    link.classList.toggle('active', link.dataset.view === viewId);
                });

                localStorage.setItem('lastActiveView', viewId);
            }
            
            function setupNavigation() {
                const navLinks = document.querySelectorAll('.nav-link');
                const topicsToggleBtn = document.getElementById('topics-toggle-btn');
                const topicsSubmenu = document.getElementById('topics-submenu');
                const toolsToggleBtn = document.getElementById('tools-toggle-btn');
                const toolsSubmenu = document.getElementById('tools-submenu');
                const topicsArrow = document.getElementById('topics-arrow');
                const toolsArrow = document.getElementById('tools-arrow');
                const topicFilters = document.querySelectorAll('.topic-filter');

                openSidebarBtn.addEventListener('click', () => sidebar.classList.remove('-translate-x-full'));
                closeSidebarBtn.addEventListener('click', () => sidebar.classList.add('-translate-x-full'));

                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        navigateToView(link.dataset.view);
                        if (window.innerWidth < 1024) {
                           sidebar.classList.add('-translate-x-full');
                        }
                    });
                });

                topicsToggleBtn.addEventListener('click', () => {
                    if (topicsSubmenu.style.maxHeight) {
                        topicsSubmenu.style.maxHeight = null;
                        topicsArrow.classList.remove('rotate-180');
                    } else {
                        topicsSubmenu.style.maxHeight = topicsSubmenu.scrollHeight + "px";
                        topicsArrow.classList.add('rotate-180');
                    }
                });
                
                toolsToggleBtn.addEventListener('click', () => {
                    if (toolsSubmenu.style.maxHeight) {
                        toolsSubmenu.style.maxHeight = null;
                        toolsArrow.classList.remove('rotate-180');
                    } else {
                        toolsSubmenu.style.maxHeight = toolsSubmenu.scrollHeight + "px";
                        toolsArrow.classList.add('rotate-180');
                    }
                });

                topicFilters.forEach(filter => {
                    filter.addEventListener('click', (e) => {
                        e.preventDefault();
                        const moduleToShow = filter.dataset.module;
                        navigateToView('dashboard-home');
                        document.querySelectorAll('.module-card').forEach(card => {
                            card.style.display = (moduleToShow === 'all' || card.dataset.module === moduleToShow) ? 'flex' : 'none';
                        });
                        if (window.innerWidth < 1024) {
                           sidebar.classList.add('-translate-x-full');
                        }
                    });
                });
            }

            function setupPrincipleModals() {
                const modal = document.getElementById('principle-modal');
                const modalContent = modal.querySelector('.transform');
                const modalTitle = document.getElementById('principle-modal-title');
                const modalDescription = document.getElementById('principle-modal-description');
                const modalTasks = document.getElementById('principle-modal-tasks');
                const closeBtn = document.getElementById('principle-modal-close-btn');
                const okBtn = document.getElementById('principle-modal-ok-btn');

                function showModal() {
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                    setTimeout(() => {
                        modal.classList.remove('opacity-0');
                        modalContent.classList.remove('scale-95');
                    }, 10);
                }

                function hideModal() {
                    modal.classList.add('opacity-0');
                    modalContent.classList.add('scale-95');
                    setTimeout(() => {
                        modal.classList.add('hidden');
                        modal.classList.remove('flex');
                    }, 300);
                }

                document.getElementById('curriculum-grid').addEventListener('click', (e) => {
                    const learnMoreBtn = e.target.closest('.learn-more-btn');
                    if (learnMoreBtn) {
                        const title = learnMoreBtn.dataset.module;
                        const description = learnMoreBtn.dataset.description;
                        const topics = JSON.parse(learnMoreBtn.dataset.topics);

                        modalTitle.textContent = title;
                        modalDescription.textContent = description;
                        
                        modalTasks.innerHTML = ''; // Clear previous content
                        let tasksHtml = '';
                        topics.forEach(topic => {
                            tasksHtml += `<h4 class="font-semibold text-lg mt-4 mb-2 text-slate-800 dark:text-white">${topic.title}</h4>`;
                            tasksHtml += '<ul class="list-disc list-inside space-y-1 text-slate-600 dark:text-slate-400">';
                            topic.items.forEach(item => {
                                tasksHtml += `<li>${item}</li>`;
                            });
                            tasksHtml += '</ul>';
                        });
                        modalTasks.innerHTML = tasksHtml;

                        showModal();
                    }
                });

                closeBtn.addEventListener('click', hideModal);
                okBtn.addEventListener('click', hideModal);
                modal.addEventListener('click', (e) => {
                    if(e.target === modal) {
                        hideModal();
                    }
                })
            }
            
            function setupPomodoro() {
                const pomodoroPage = document.getElementById('pomodoro');
                const modes = {
                    pomodoro: {
                        name: 'Focus',
                        time: 25,
                        color: '#F97316', // orange-500
                        icon: 'üçÖ',
                        next: 'shortBreak',
                        background: 'https://images.unsplash.com/photo-1484417894907-623942c8ee29?q=80&w=3132&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
                    },
                    shortBreak: {
                        name: 'Relax',
                        time: 5,
                        color: '#3B82F6', // blue-500
                        icon: '‚òï',
                        next: 'pomodoro',
                        background: 'https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
                    },
                };

                let timer;
                let currentMode = 'pomodoro';
                let totalSeconds = modes[currentMode].time * 60;
                let remainingSeconds = totalSeconds;
                let isPaused = true;
                let sessionCount = 0;

                const canvas = document.getElementById('pomodoro-canvas');
                const ctx = canvas.getContext('2d');
                const timeDisplay = document.getElementById('pomodoro-time');
                const modeDisplay = document.getElementById('pomodoro-mode');
                const iconDisplay = document.getElementById('pomodoro-icon');
                const playPauseBtn = document.getElementById('pomodoro-play-pause');
                const playIcon = document.getElementById('play-icon');
                const pauseIcon = document.getElementById('pause-icon');
                const switchModeBtn = document.getElementById('pomodoro-switch-mode');
                const sessionCountDisplay = document.getElementById('pomodoro-session-count');

                function drawCircle(progress) {
                    const centerX = canvas.width / 2;
                    const centerY = canvas.height / 2;
                    const radius = canvas.width / 2 - 10;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.lineWidth = 12;
                    ctx.stroke();

                    if (progress > 0) {
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, radius, -0.5 * Math.PI, (progress * 2 * Math.PI) - 0.5 * Math.PI);
                        ctx.strokeStyle = modes[currentMode].color;
                        ctx.lineWidth = 12;
                        ctx.lineCap = 'round';
                        ctx.stroke();
                    }
                }

                function updateDisplay() {
                    const minutes = Math.floor(remainingSeconds / 60);
                    const seconds = remainingSeconds % 60;
                    timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    const progress = (totalSeconds - remainingSeconds) / totalSeconds;
                    drawCircle(progress);
                }
                
                function setMode(modeKey) {
                    currentMode = modeKey;
                    const mode = modes[currentMode];
                    totalSeconds = mode.time * 60;
                    remainingSeconds = totalSeconds;
                    modeDisplay.textContent = mode.name;
                    iconDisplay.textContent = mode.icon;
                    switchModeBtn.textContent = mode.next === 'pomodoro' ? 'Start Focus' : 'Take a Break';
                    pomodoroPage.style.backgroundImage = `url('${mode.background}')`;
                    updateDisplay();
                }

                function countdown() {
                    if (isPaused) return;
                    if (remainingSeconds > 0) {
                        remainingSeconds--;
                        updateDisplay();
                    } else {
                        clearInterval(timer);
                        isPaused = true;
                        playIcon.classList.remove('hidden');
                        pauseIcon.classList.add('hidden');
                        
                        if (currentMode === 'pomodoro') {
                            sessionCount++;
                            sessionCountDisplay.textContent = sessionCount;
                        }

                        showAlert(`${modes[currentMode].name} session is over!`);
                        setMode(modes[currentMode].next);
                    }
                }

                playPauseBtn.addEventListener('click', () => {
                    hideAlert();
                    isPaused = !isPaused;
                    if (!isPaused) {
                        timer = setInterval(countdown, 1000);
                        playIcon.classList.add('hidden');
                        pauseIcon.classList.remove('hidden');
                    } else {
                        clearInterval(timer);
                        playIcon.classList.remove('hidden');
                        pauseIcon.classList.add('hidden');
                    }
                });

                switchModeBtn.addEventListener('click', () => {
                    hideAlert();
                    isPaused = true;
                    clearInterval(timer);
                    playIcon.classList.remove('hidden');
                    pauseIcon.classList.add('hidden');
                    setMode(modes[currentMode].next);
                });
                
                setMode('pomodoro'); // Initialize
            }

            function setupMindfulness() {
                const startBtn = document.getElementById('mindfulness-start-btn');
                const durationSelect = document.getElementById('mindfulness-duration');
                const visualizer = document.getElementById('breathing-visualizer');
                const instruction = document.getElementById('breathing-instruction');
                const sessionCountEl = document.getElementById('mindfulness-session-count');

                let sessionTimer;
                let instructionTimer;
                let isBreathing = false;
                const BREATHE_IN = 4000;
                const HOLD = 2000;
                const BREATHE_OUT = 4000;
                const CYCLE_TIME = BREATHE_IN + HOLD + BREATHE_OUT;

                function loadSessionCount() {
                    const count = localStorage.getItem('mindfulnessSessions') || 0;
                    sessionCountEl.textContent = count;
                }

                function updateInstruction() {
                    instruction.style.opacity = 0;
                    setTimeout(() => {
                        instruction.textContent = "Breathe In...";
                        instruction.style.opacity = 1;
                    }, 500);

                    setTimeout(() => {
                        instruction.style.opacity = 0;
                        setTimeout(() => {
                            instruction.textContent = "Hold";
                            instruction.style.opacity = 1;
                        }, 500);
                    }, BREATHE_IN);

                    setTimeout(() => {
                        instruction.style.opacity = 0;
                        setTimeout(() => {
                            instruction.textContent = "Breathe Out...";
                            instruction.style.opacity = 1;
                        }, 500);
                    }, BREATHE_IN + HOLD);
                }

                function startSession() {
                    if (isBreathing) return;
                    isBreathing = true;

                    const duration = parseInt(durationSelect.value) * 1000;
                    startBtn.textContent = 'Session in Progress...';
                    startBtn.disabled = true;
                    durationSelect.disabled = true;

                    visualizer.classList.add('breathing');
                    updateInstruction();
                    instructionTimer = setInterval(updateInstruction, CYCLE_TIME);

                    sessionTimer = setTimeout(() => {
                        endSession(true);
                    }, duration);
                }

                function endSession(completed = false) {
                    isBreathing = false;
                    clearInterval(instructionTimer);
                    clearTimeout(sessionTimer);

                    visualizer.classList.remove('breathing');
                    instruction.textContent = "Ready?";
                    startBtn.textContent = 'Start Session';
                    startBtn.disabled = false;
                    durationSelect.disabled = false;

                    if (completed) {
                        let count = parseInt(localStorage.getItem('mindfulnessSessions') || 0);
                        count++;
                        localStorage.setItem('mindfulnessSessions', count);
                        sessionCountEl.textContent = count;
                        showAlert("Mindfulness session complete. Well done!");
                    }
                }
                
                startBtn.addEventListener('click', startSession);
                loadSessionCount();
            }
            
            function setupShiftTimer() {
                const shiftTimerPage = document.getElementById('shift-timer');
                const setupView = document.getElementById('shift-setup');
                const countdownView = document.getElementById('shift-countdown-display');
                const endView = document.getElementById('shift-end-message');
                const startBtn = document.getElementById('start-shift-btn');
                const resetBtn = document.getElementById('reset-shift-btn');
                const newShiftBtn = document.getElementById('new-shift-btn');
                const endTimeInput = document.getElementById('shift-end-time-input');
                const endTimeLabel = document.getElementById('shift-end-time-label');
                const startTimeLabel = document.getElementById('shift-start-time-label');
                const shiftBlocksContainer = document.getElementById('shift-blocks-container');
                const presetNormalBtn = document.getElementById('preset-normal-btn');
                const presetOvertimeBtn = document.getElementById('preset-overtime-btn');
                const shiftTitleInput = document.getElementById('shift-title-input');
                const motivationQuote = document.getElementById('shift-motivation-quote');
                
                // Break Elements
                const addBreakBtn = document.getElementById('add-break-btn');
                const loadMyBreaksBtn = document.getElementById('load-my-breaks-btn');
                const breakTimesContainer = document.getElementById('break-times-container');
                const healthBreaksToggle = document.getElementById('health-breaks-toggle');
                
                // Active Break Display
                const breakActiveDisplay = document.getElementById('break-active-display');
                const breakTimerLarge = document.getElementById('break-timer-large');
                const breakAlertBanner = document.getElementById('break-alert-banner');
                
                // Next Break Display
                const nextBreakContainer = document.getElementById('next-break-container');
                const timeToNextBreakEl = document.getElementById('time-to-next-break');
                const nextBreakTimeLabel = document.getElementById('next-break-time-label');

                let shiftTimer;
                let shiftStartTime;
                let shiftEndTime;
                let totalShiftDuration;
                let activeAnimationId;
                
                // User defined break strings (HH:MM) and durations
                let userBreakConfigs = JSON.parse(localStorage.getItem('shiftUserBreakConfigs')) || [];
                // Calculated Break Date Objects for the current shift
                let activeBreakObjects = []; 
                let autoScheduleHealthBreaks = localStorage.getItem('shiftAutoHealthBreaks') === 'true';

                const canvas = document.getElementById('shift-timer-canvas');
                const ctx = canvas.getContext('2d');
                const mouse = { x: null, y: null, radius: 150 };

                // Initialize Toggle State
                healthBreaksToggle.checked = autoScheduleHealthBreaks;
                healthBreaksToggle.addEventListener('change', (e) => {
                    autoScheduleHealthBreaks = e.target.checked;
                    localStorage.setItem('shiftAutoHealthBreaks', autoScheduleHealthBreaks);
                });

                function formatTime(ms) {
                    const totalSeconds = Math.floor(ms / 1000);
                    const h = Math.floor(totalSeconds / 3600);
                    const m = Math.floor((totalSeconds % 3600) / 60);
                    const s = totalSeconds % 60;
                    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                }
                
                function formatTimeShort(ms) {
                     const totalSeconds = Math.floor(ms / 1000);
                    const h = Math.floor(totalSeconds / 3600);
                    const m = Math.floor((totalSeconds % 3600) / 60);
                    const s = totalSeconds % 60;
                    if (h > 0) return `${h}h ${m}m ${s}s`;
                    return `${m}m ${s}s`;
                }

                function formatDateTimeForInput(date) {
                    const pad = (num) => num.toString().padStart(2, '0');
                    return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
                }

                // Render Setup List
                function renderSetupBreaks() {
                    breakTimesContainer.innerHTML = '';
                    userBreakConfigs.sort((a, b) => a.startTime.localeCompare(b.startTime));
                    
                    if (userBreakConfigs.length === 0) {
                        breakTimesContainer.innerHTML = '<p class="text-gray-500 text-xs italic text-center py-2">No specific breaks set.</p>';
                    }

                    userBreakConfigs.forEach((breakItem, index) => {
                        const breakEl = document.createElement('div');
                        breakEl.className = 'flex items-center space-x-2 text-sm text-gray-300 bg-gray-800/50 p-2 rounded-lg';
                        breakEl.innerHTML = `
                            <input type="time" value="${breakItem.startTime}" class="break-start-time w-1/3 p-1 rounded bg-gray-700 text-white border-transparent focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-xs">
                            <div class="flex items-center w-1/3">
                                <input type="number" value="${breakItem.duration}" min="1" class="break-duration w-full p-1 rounded-l bg-gray-700 text-white border-transparent focus:border-indigo-500 text-xs text-center">
                                <span class="bg-gray-600 px-2 py-1 rounded-r text-xs">m</span>
                            </div>
                            <button class="remove-break-btn ml-auto text-red-400 hover:text-red-300 hover:bg-red-900/20 p-1 rounded transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        `;
                        breakTimesContainer.appendChild(breakEl);

                        breakEl.querySelector('.remove-break-btn').addEventListener('click', () => {
                            userBreakConfigs.splice(index, 1);
                            saveUserBreaks();
                            renderSetupBreaks();
                        });
                        breakEl.querySelector('.break-start-time').addEventListener('change', (e) => {
                            userBreakConfigs[index].startTime = e.target.value;
                            saveUserBreaks();
                        });
                        breakEl.querySelector('.break-duration').addEventListener('change', (e) => {
                            userBreakConfigs[index].duration = parseInt(e.target.value);
                            saveUserBreaks();
                        });
                    });
                }

                function saveUserBreaks() {
                    localStorage.setItem('shiftUserBreakConfigs', JSON.stringify(userBreakConfigs));
                }
                
                addBreakBtn.addEventListener('click', () => {
                    userBreakConfigs.push({ startTime: '00:00', duration: 15, type: 'manual' });
                    saveUserBreaks();
                    renderSetupBreaks();
                });

                loadMyBreaksBtn.addEventListener('click', () => {
                    userBreakConfigs = [
                        { startTime: '22:00', duration: 10, type: 'manual' },
                        { startTime: '00:00', duration: 10, type: 'manual' },
                        { startTime: '03:15', duration: 30, type: 'manual' },
                        { startTime: '05:00', duration: 10, type: 'manual' }
                    ];
                    saveUserBreaks();
                    renderSetupBreaks();
                });

                presetNormalBtn.addEventListener('click', () => {
                    const now = new Date();
                    const nextDay = new Date(now);
                    nextDay.setDate(now.getHours() >= 7 ? now.getDate() + 1 : now.getDate());
                    nextDay.setHours(7, 0, 0, 0);
                    endTimeInput.value = formatDateTimeForInput(nextDay);
                });

                presetOvertimeBtn.addEventListener('click', () => {
                    const now = new Date();
                    const nextDay = new Date(now);
                    nextDay.setDate(now.getHours() >= 5 ? now.getDate() + 1 : now.getDate());
                    nextDay.setHours(5, 0, 0, 0);
                    endTimeInput.value = formatDateTimeForInput(nextDay);
                });

                function updateShiftDisplay(remainingMs) {
                    const h = Math.floor(remainingMs / (1000 * 60 * 60));
                    const m = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
                    const s = Math.floor((remainingMs % (1000 * 60)) / 1000);

                    document.getElementById('shift-hours-display').textContent = h.toString().padStart(2, '0');
                    document.getElementById('shift-minutes-display').textContent = m.toString().padStart(2, '0');
                    document.getElementById('shift-seconds-display').textContent = s.toString().padStart(2, '0');
                }

                function generateShiftBlocks() {
                    shiftBlocksContainer.innerHTML = '';
                    
                    // Add Global Indicator Line
                    const indicator = document.createElement('div');
                    indicator.id = 'shift-global-indicator';
                    indicator.className = "absolute top-0 bottom-0 w-0.5 bg-white shadow-[0_0_15px_white] z-20 transition-all duration-1000 ease-linear pointer-events-none";
                    indicator.style.left = '0%';
                    
                    const indicatorTag = document.createElement('div');
                    indicatorTag.className = "absolute -top-2 left-1/2 -translate-x-1/2 bg-white text-indigo-900 text-[9px] font-black px-1.5 py-0.5 rounded shadow-sm whitespace-nowrap uppercase tracking-tighter transform -translate-y-full";
                    indicatorTag.textContent = "You Are Here";
                    
                    // Arrow down
                    const arrow = document.createElement('div');
                    arrow.className = "absolute -bottom-1 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[4px] border-l-transparent border-r-[4px] border-r-transparent border-t-[4px] border-t-white";
                    indicatorTag.appendChild(arrow);
                    
                    indicator.appendChild(indicatorTag);
                    shiftBlocksContainer.appendChild(indicator);

                    const totalHours = Math.ceil(totalShiftDuration / (1000 * 60 * 60));
                    
                    for (let i = 0; i < totalHours; i++) {
                        const block = document.createElement('div');
                        // Flex-1 ensures they share the full width equally (Visualizing the Whole)
                        block.className = "flex-1 border-r border-gray-800 last:border-r-0 relative group bg-gray-900/50";
                        
                        // Fill element
                        const fill = document.createElement('div');
                        fill.id = `shift-block-fill-${i}`;
                        fill.className = "absolute top-0 left-0 h-full w-0 bg-gradient-to-r from-red-700 to-red-600 transition-all duration-300";
                        
                        // Hour Label
                        const label = document.createElement('div');
                        label.className = "absolute bottom-1 right-1.5 text-[10px] text-gray-600 font-mono font-bold z-10 select-none";
                        label.textContent = `${i + 1}h`;

                        block.appendChild(fill);
                        block.appendChild(label);
                        shiftBlocksContainer.appendChild(block);
                    }
                }

                function updateShiftVisuals() {
                    const now = new Date();
                    const elapsedMs = now - shiftStartTime;
                    const totalMs = totalShiftDuration;
                    const hourMs = 1000 * 60 * 60;
                    const totalHours = Math.ceil(totalMs / hourMs);

                    // Update Global Indicator Position
                    const percentage = Math.min(100, Math.max(0, (elapsedMs / totalMs) * 100));
                    const indicator = document.getElementById('shift-global-indicator');
                    if (indicator) {
                        indicator.style.left = `${percentage}%`;
                    }

                    // Update Block Fills
                    for (let i = 0; i < totalHours; i++) {
                        const fill = document.getElementById(`shift-block-fill-${i}`);
                        if (!fill) continue;
                        
                        const blockStartMs = i * hourMs;
                        const blockEndMs = (i + 1) * hourMs;

                        if (elapsedMs >= blockEndMs) {
                            // Fully completed
                            fill.style.width = '100%';
                        } else if (elapsedMs > blockStartMs) {
                            // Currently active
                            const progress = (elapsedMs - blockStartMs) / hourMs;
                            fill.style.width = `${progress * 100}%`;
                        } else {
                            // Future
                            fill.style.width = '0%';
                        }
                    }
                }

                function calculateActiveBreaks() {
                    activeBreakObjects = [];
                    // 1. Convert user configs (HH:MM) to Date objects relative to shift start
                    userBreakConfigs.forEach(config => {
                        const [hours, minutes] = config.startTime.split(':').map(Number);
                        
                        // Create a date for this break
                        let breakStart = new Date(shiftStartTime);
                        breakStart.setHours(hours, minutes, 0, 0);

                        // Adjust date if shift crosses midnight
                        if (breakStart < shiftStartTime) {
                            breakStart.setDate(breakStart.getDate() + 1);
                        }
                        
                        const breakEnd = new Date(breakStart.getTime() + config.duration * 60000);
                        
                        // Only add if it falls within the shift
                        if (breakStart >= shiftStartTime && breakStart < shiftEndTime) {
                            activeBreakObjects.push({
                                start: breakStart,
                                end: breakEnd,
                                type: 'Standard Break',
                                duration: config.duration
                            });
                        }
                    });

                    // 2. Auto-schedule Health Breaks (5 mins every 60 mins gap)
                    if (autoScheduleHealthBreaks) {
                        // Sort existing breaks
                        activeBreakObjects.sort((a, b) => a.start - b.start);
                        
                        let pointer = new Date(shiftStartTime);
                        const healthIntervalMs = 60 * 60 * 1000; // 1 hour
                        const healthDurationMs = 5 * 60 * 1000; // 5 mins
                        
                        // We iterate until end of shift
                        while (pointer.getTime() + healthIntervalMs < shiftEndTime.getTime()) {
                            const potentialHealthStart = new Date(pointer.getTime() + healthIntervalMs);
                            const potentialHealthEnd = new Date(potentialHealthStart.getTime() + healthDurationMs);
                            
                            // Check for collision with existing breaks or end of shift
                            let collision = false;
                            
                            // Don't schedule if it pushes past end time
                            if (potentialHealthEnd > shiftEndTime) break;

                            // Check collision with existing breaks (allow a buffer of ~15 mins)
                            for (let b of activeBreakObjects) {
                                // If potential break overlaps or is too close (within 15 mins) to a standard break
                                const buffer = 15 * 60 * 1000;
                                if (
                                    (potentialHealthStart >= new Date(b.start.getTime() - buffer) && potentialHealthStart < new Date(b.end.getTime() + buffer)) ||
                                    (potentialHealthEnd > new Date(b.start.getTime() - buffer) && potentialHealthEnd <= new Date(b.end.getTime() + buffer))
                                ) {
                                    collision = true;
                                    // Move pointer to end of this colliding break
                                    pointer = new Date(b.end);
                                    break;
                                }
                            }

                            if (!collision) {
                                activeBreakObjects.push({
                                    start: potentialHealthStart,
                                    end: potentialHealthEnd,
                                    type: 'Health Break',
                                    duration: 5
                                });
                                pointer = potentialHealthEnd; // Next check starts after this break
                            }
                        }
                        
                        // Re-sort after adding health breaks
                        activeBreakObjects.sort((a, b) => a.start - b.start);
                    }
                    
                    localStorage.setItem('shiftActiveBreakObjects', JSON.stringify(activeBreakObjects));
                }

                function shiftCountdown() {
                    const now = new Date();
                    
                    // 1. Check if shift ended
                    if (now >= shiftEndTime) {
                        clearInterval(shiftTimer);
                        updateShiftDisplay(0);
                        updateShiftVisuals();
                        countdownView.classList.add('hidden');
                        endView.classList.remove('hidden');
                        stopActiveAnimation();
                        localStorage.removeItem('shiftEndTime');
                        return;
                    }

                    const remainingMs = shiftEndTime - now;
                    updateShiftDisplay(remainingMs);
                    updateShiftVisuals();

                    // 2. Check Break Status
                    let currentBreak = null;
                    let nextBreak = null;

                    for (const b of activeBreakObjects) {
                        const start = new Date(b.start);
                        const end = new Date(b.end);
                        
                        if (now >= start && now < end) {
                            currentBreak = b;
                            break; // Found active
                        }
                        if (now < start && !nextBreak) {
                            nextBreak = b;
                        }
                    }

                    if (currentBreak) {
                        // ON BREAK
                        breakActiveDisplay.classList.remove('hidden');
                        breakAlertBanner.classList.remove('hidden');
                        nextBreakContainer.classList.add('opacity-0'); // Hide next break info
                        
                        const breakRemaining = new Date(currentBreak.end) - now;
                        breakTimerLarge.textContent = formatTimeShort(breakRemaining);
                        motivationQuote.textContent = "Recharge Mode On";
                    } else {
                        // WORKING
                        breakActiveDisplay.classList.add('hidden');
                        breakAlertBanner.classList.add('hidden');
                        nextBreakContainer.classList.remove('opacity-0');
                        motivationQuote.textContent = shiftTitleInput.value || "Let's get this bread!";
                        
                        if (nextBreak) {
                            const timeToNext = new Date(nextBreak.start) - now;
                            timeToNextBreakEl.textContent = formatTime(timeToNext);
                            const nextBreakTimeStr = new Date(nextBreak.start).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                            nextBreakTimeLabel.textContent = `at ${nextBreakTimeStr} (${nextBreak.type})`;
                            
                            // Alert if break is soon (e.g. < 1 min)
                            if (timeToNext < 60000 && timeToNext > 59000) {
                                // optional beep or visual flash could go here
                            }
                        } else {
                            timeToNextBreakEl.textContent = "--:--:--";
                            nextBreakTimeLabel.textContent = "No more breaks scheduled";
                        }
                    }
                }

                function resetShiftTimer() {
                    clearInterval(shiftTimer);
                    stopActiveAnimation();
                    localStorage.removeItem('shiftEndTime');
                    localStorage.removeItem('shiftStartTime');
                    localStorage.removeItem('shiftActiveBreakObjects');
                    localStorage.removeItem('shiftTitle');
                    
                    setupView.classList.remove('hidden');
                    countdownView.classList.add('hidden');
                    endView.classList.add('hidden');
                    breakActiveDisplay.classList.add('hidden');
                }

                function checkStoredShift() {
                    const storedEndTime = localStorage.getItem('shiftEndTime');
                    const storedStartTime = localStorage.getItem('shiftStartTime');
                    const storedBreaks = localStorage.getItem('shiftActiveBreakObjects');
                    const storedTitle = localStorage.getItem('shiftTitle');
                    
                    renderSetupBreaks();

                    if (storedEndTime && storedStartTime) {
                        shiftEndTime = new Date(storedEndTime);
                        shiftStartTime = new Date(storedStartTime);
                        if (storedBreaks) activeBreakObjects = JSON.parse(storedBreaks);
                        if (storedTitle) shiftTitleInput.value = storedTitle;
                        
                        if (shiftEndTime > new Date()) {
                            totalShiftDuration = shiftEndTime - shiftStartTime;
                            setupView.classList.add('hidden');
                            countdownView.classList.remove('hidden');
                            
                            endTimeLabel.textContent = `End: ${shiftEndTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                            startTimeLabel.textContent = `Start: ${shiftStartTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                            
                            generateShiftBlocks();
                            shiftCountdown();
                            shiftTimer = setInterval(shiftCountdown, 1000);
                            startRandomAnimation();
                        } else {
                            resetShiftTimer();
                        }
                    }
                }

                startBtn.addEventListener('click', () => {
                    const endTimeValue = endTimeInput.value;
                    if (!endTimeValue) {
                        showAlert("Please select an end date and time.");
                        return;
                    }
                    
                    shiftEndTime = new Date(endTimeValue);
                    
                    // FIX: Always calculate Start Time as 7:00 PM (19:00) relative to End Time
                    shiftStartTime = new Date(shiftEndTime);
                    shiftStartTime.setHours(19, 0, 0, 0); // Set to 19:00
                    
                    // If the calculated start time (19:00 on the same day as end time) is after the end time,
                    // it means the shift started the previous day.
                    // Example: End is 07:00 (Day 2). Candidate Start is 19:00 (Day 2). 19 > 07, so Start is 19:00 (Day 1).
                    if (shiftStartTime >= shiftEndTime) {
                        shiftStartTime.setDate(shiftStartTime.getDate() - 1);
                    }

                    // Check if shift has effectively ended already relative to now
                    if (shiftEndTime <= new Date()) {
                        showAlert("The selected shift end time is in the past.");
                        return;
                    }

                    localStorage.setItem('shiftStartTime', shiftStartTime.toISOString());
                    localStorage.setItem('shiftEndTime', shiftEndTime.toISOString());
                    localStorage.setItem('shiftTitle', shiftTitleInput.value);
                    
                    totalShiftDuration = (shiftEndTime - shiftStartTime);
                    
                    // Calculate breaks specifically for this shift instance
                    calculateActiveBreaks();
                    
                    setupView.classList.add('hidden');
                    countdownView.classList.remove('hidden');
                    
                    endTimeLabel.textContent = `End: ${shiftEndTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                    startTimeLabel.textContent = `Start: ${shiftStartTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                    
                    generateShiftBlocks();
                    shiftCountdown(); // Initial call
                    shiftTimer = setInterval(shiftCountdown, 1000);
                    startRandomAnimation();
                });

                resetBtn.addEventListener('click', resetShiftTimer);
                newShiftBtn.addEventListener('click', resetShiftTimer);
                
                // Animation Functions
                const animations = [initConstellation];
                let currentAnimationId;

                function startRandomAnimation() {
                    stopActiveAnimation();
                    const randomIndex = Math.floor(Math.random() * animations.length);
                    animations[randomIndex]();
                }

                function stopActiveAnimation() {
                    if (currentAnimationId) {
                        cancelAnimationFrame(currentAnimationId);
                    }
                    window.removeEventListener('resize', resizeCanvas);
                    shiftTimerPage.removeEventListener('mousemove', ()=>{});
                    shiftTimerPage.removeEventListener('mouseout', ()=>{});
                }

                function resizeCanvas() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }

                function initConstellation() {
                    let particles = [];
                    const numParticles = 100;
                    
                    function localResize() {
                        resizeCanvas();
                        particles = [];
                        for(let i = 0; i < numParticles; i++) {
                            particles.push({
                                x: Math.random() * canvas.width,
                                y: Math.random() * canvas.height,
                                vx: Math.random() * 0.4 - 0.2,
                                vy: Math.random() * 0.4 - 0.2,
                                radius: Math.random() * 1.5 + 1
                            });
                        }
                    }
                    localResize();
                    window.addEventListener('resize', localResize);
                    
                    shiftTimerPage.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
                    shiftTimerPage.addEventListener('mouseout', () => { mouse.x = null; mouse.y = null; });

                    function draw() {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = '#111827';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);

                        for(let i = 0; i < particles.length; i++) {
                            const p = particles[i];
                            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                            ctx.beginPath();
                            ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                            ctx.fill();

                            p.x += p.vx;
                            p.y += p.vy;

                            if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                            if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                            for(let j = i + 1; j < particles.length; j++) {
                                const p2 = particles[j];
                                const dx = p.x - p2.x;
                                const dy = p.y - p2.y;
                                const dist = Math.sqrt(dx * dx + dy * dy);

                                if (dist < 120) {
                                    ctx.beginPath();
                                    ctx.moveTo(p.x, p.y);
                                    ctx.lineTo(p2.x, p2.y);
                                    ctx.strokeStyle = `rgba(255, 255, 255, ${1 - dist/120})`;
                                    ctx.lineWidth = 0.5;
                                    ctx.stroke();
                                }
                            }
                            
                            if (mouse.x) {
                                const mdx = p.x - mouse.x;
                                const mdy = p.y - mouse.y;
                                const mDist = Math.sqrt(mdx*mdx + mdy*mdy);
                                if (mDist < 150) {
                                     ctx.beginPath();
                                     ctx.moveTo(p.x, p.y);
                                     ctx.lineTo(mouse.x, mouse.y);
                                     ctx.strokeStyle = `rgba(250, 204, 21, ${1 - mDist/150})`;
                                     ctx.lineWidth = 0.5;
                                     ctx.stroke();
                                }
                            }
                        }
                    }

                    function animate() {
                        draw();
                        currentAnimationId = requestAnimationFrame(animate);
                    }
                    animate();
                }
                
                // Initialize setup view
                checkStoredShift();
            }
            
            function initLandingPageAnimation() {
                const canvas = landingCanvas;
                const ctx = canvas.getContext('2d');
                let particles = [];
                const mouse = { x: null, y: null, radius: 100 };

                window.addEventListener('mousemove', (event) => {
                    mouse.x = event.x;
                    mouse.y = event.y;
                });
                window.addEventListener('mouseout', () => {
                    mouse.x = null;
                    mouse.y = null;
                });


                function resizeCanvas() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);

                class Particle {
                    constructor() {
                        this.x = Math.random() * canvas.width;
                        this.y = Math.random() * canvas.height;
                        this.baseX = this.x;
                        this.baseY = this.y;
                        this.size = Math.random() * 2.5 + 1;
                        this.density = (Math.random() * 30) + 1;
                        this.color = `rgba(139, 92, 246, ${Math.random() * 0.5 + 0.2})`;
                    }
                    update() {
                        let dx = mouse.x - this.x;
                        let dy = mouse.y - this.y;
                        let distance = Math.sqrt(dx * dx + dy * dy);
                        let forceDirectionX = dx / distance;
                        let forceDirectionY = dy / distance;
                        let maxDistance = mouse.radius;
                        let force = (maxDistance - distance) / maxDistance;
                        let directionX = forceDirectionX * force * this.density;
                        let directionY = forceDirectionY * force * this.density;

                        if (distance < mouse.radius) {
                            this.x -= directionX;
                            this.y -= directionY;
                        } else {
                            if (this.x !== this.baseX) {
                                let dx = this.x - this.baseX;
                                this.x -= dx / 10;
                            }
                            if (this.y !== this.baseY) {
                                let dy = this.y - this.baseY;
                                this.y -= dy / 10;
                            }
                        }
                    }
                    draw() {
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                function initParticles() {
                    particles = [];
                    for (let i = 0; i < 150; i++) {
                        particles.push(new Particle());
                    }
                }
                initParticles();

                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    for (let i = 0; i < particles.length; i++) {
                        particles[i].update();
                        particles[i].draw();
                    }
                    requestAnimationFrame(animate);
                }
                animate();
            }
            
            // Initial Load Logic
            if (localStorage.getItem('appEntered') === 'true') {
                 landingPage.style.display = 'none';
                 appLayout.classList.remove('hidden-fade');
                 appLayout.classList.add('visible-fade');
                 initializeDashboard();
                 const lastView = localStorage.getItem('lastActiveView') || 'dashboard-home';
                 navigateToView(lastView);
            } else {
                initLandingPageAnimation();
            }
        });

        function setupHourCalculator() {
            const timeEntriesContainer = document.getElementById('time-entries');
            const addRowBtn = document.getElementById('add-time-row');
            const calculateBtn = document.getElementById('calculate-time-btn');
            const clearBtn = document.getElementById('clear-time-btn');
            const printBtn = document.getElementById('print-time-btn');
            const totalHms = document.getElementById('total-time-hms');
            const totalDecimal = document.getElementById('total-time-decimal');

            function createTimeRow() {
                const row = document.createElement('div');
                row.className = 'flex items-center space-x-2';
                row.innerHTML = `
                    <input type="number" class="time-input w-16 p-2 border rounded-md text-center dark:bg-gray-700 dark:text-white" placeholder="00" min="0">
                    <span class="font-bold">:</span>
                    <input type="number" class="time-input w-16 p-2 border rounded-md text-center dark:bg-gray-700 dark:text-white" placeholder="00" min="0" max="59">
                    <span class="font-bold">:</span>
                    <input type="number" class="time-input w-16 p-2 border rounded-md text-center dark:bg-gray-700 dark:text-white" placeholder="00" min="0" max="59">
                `;
                timeEntriesContainer.appendChild(row);
            }

            addRowBtn.addEventListener('click', createTimeRow);

            calculateBtn.addEventListener('click', () => {
                let totalSeconds = 0;
                const rows = timeEntriesContainer.querySelectorAll('.flex');
                rows.forEach(row => {
                    const inputs = row.querySelectorAll('.time-input');
                    const hours = parseInt(inputs[0].value) || 0;
                    const minutes = parseInt(inputs[1].value) || 0;
                    const seconds = parseInt(inputs[2].value) || 0;
                    totalSeconds += (hours * 3600) + (minutes * 60) + seconds;
                });

                const totalHours = Math.floor(totalSeconds / 3600);
                const totalMinutes = Math.floor((totalSeconds % 3600) / 60);
                const remainingSeconds = totalSeconds % 60;

                totalHms.textContent = `${totalHours.toString().padStart(2, '0')}:${totalMinutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
                totalDecimal.textContent = (totalSeconds / 3600).toFixed(2);
            });

            clearBtn.addEventListener('click', () => {
                timeEntriesContainer.innerHTML = '';
                for(let i=0; i<5; i++) createTimeRow();
                totalHms.textContent = '00:00:00';
                totalDecimal.textContent = '0.00';
            });
            
            printBtn.addEventListener('click', () => {
                window.print();
            });

            // Initial rows
            for(let i=0; i<5; i++) createTimeRow();
        }
        
        function setupIdeaBoard() {
            const ideaBoard = document.getElementById('idea-board');
            const addNoteBtn = document.getElementById('add-note-btn');
            const ideaBoardContainer = document.getElementById('idea-board-container');
            let notes = JSON.parse(localStorage.getItem('sticky-notes')) || [];
            let activeNote = null;
            let offsetX, offsetY;

            const colors = ['bg-yellow-200', 'bg-green-200', 'bg-pink-200', 'bg-blue-200', 'bg-purple-200'];

            function saveNotes() {
                localStorage.setItem('sticky-notes', JSON.stringify(notes));
            }

            function createNoteElement(note) {
                const noteEl = document.createElement('div');
                noteEl.id = note.id;
                noteEl.className = `sticky-note absolute w-60 h-60 p-4 flex flex-col ${note.color}`;
                noteEl.style.left = `${note.x}px`;
                noteEl.style.top = `${note.y}px`;
                noteEl.innerHTML = `
                    <div class="flex-grow overflow-auto">
                        <textarea class="w-full h-full bg-transparent resize-none focus:outline-none text-gray-800">${note.content}</textarea>
                    </div>
                    <div class="flex justify-end items-center mt-2 space-x-2">
                        <button class="copy-note-btn text-gray-600 hover:text-black">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        </button>
                        <button class="delete-note-btn text-gray-600 hover:text-red-500">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </div>
                `;
                ideaBoardContainer.appendChild(noteEl);

                noteEl.addEventListener('mousedown', (e) => {
                    if (e.target.tagName.toLowerCase() === 'textarea') return;
                    activeNote = noteEl;
                    activeNote.classList.add('dragging');
                    offsetX = e.clientX - noteEl.offsetLeft;
                    offsetY = e.clientY - noteEl.offsetTop;
                });

                const textarea = noteEl.querySelector('textarea');
                textarea.addEventListener('input', () => {
                    const noteToUpdate = notes.find(n => n.id === note.id);
                    noteToUpdate.content = textarea.value;
                    saveNotes();
                });

                noteEl.querySelector('.delete-note-btn').addEventListener('click', () => {
                    notes = notes.filter(n => n.id !== note.id);
                    saveNotes();
                    noteEl.remove();
                });

                noteEl.querySelector('.copy-note-btn').addEventListener('click', (e) => {
                       const button = e.currentTarget;
                       const originalIcon = button.innerHTML;
                       const checkIcon = `<svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
                       
                       const tempInput = document.createElement('textarea');
                       tempInput.value = textarea.value;
                       document.body.appendChild(tempInput);
                       tempInput.select();
                       document.execCommand('copy');
                       document.body.removeChild(tempInput);

                       button.innerHTML = checkIcon;
                       setTimeout(() => {
                           button.innerHTML = originalIcon;
                       }, 1500)
                });
            }

            document.addEventListener('mousemove', (e) => {
                if (!activeNote) return;
                activeNote.style.left = `${e.clientX - offsetX}px`;
                activeNote.style.top = `${e.clientY - offsetY}px`;
            });

            document.addEventListener('mouseup', () => {
                if (activeNote) {
                    const noteToUpdate = notes.find(n => n.id === activeNote.id);
                    noteToUpdate.x = activeNote.offsetLeft;
                    noteToUpdate.y = activeNote.offsetTop;
                    saveNotes();
                    activeNote.classList.remove('dragging');
                }
                activeNote = null;
            });

            addNoteBtn.addEventListener('click', () => {
                const newNote = {
                    id: `note-${Date.now()}`,
                    content: '',
                    color: colors[Math.floor(Math.random() * colors.length)],
                    x: Math.random() * (ideaBoard.offsetWidth - 240),
                    y: Math.random() * (ideaBoard.offsetHeight - 240)
                };
                notes.push(newNote);
                createNoteElement(newNote);
                saveNotes();
            });

            notes.forEach(createNoteElement);
        }
        
        function setupSettings() {
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

            // Change the icons inside the button based on previous settings
            if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                themeToggleLightIcon.classList.remove('hidden');
            } else {
                themeToggleDarkIcon.classList.remove('hidden');
            }

            themeToggleBtn.addEventListener('click', function() {
                // toggle icons inside button
                themeToggleDarkIcon.classList.toggle('hidden');
                themeToggleLightIcon.classList.toggle('hidden');

                // if set via local storage previously
                if (localStorage.getItem('color-theme')) {
                    if (localStorage.getItem('color-theme') === 'light') {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    }
                // if NOT set via local storage previously
                } else {
                    if (document.documentElement.classList.contains('dark')) {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    } else {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    }
                }
            });
        }

        function updateBreachLog(item, wasCompleted) {
            let log = JSON.parse(localStorage.getItem('dailyBreachLog')) || {};
            
            // If the item was just completed
            if (item.completed && !wasCompleted) {
                const completedDate = new Date(item.completedAt).toISOString().split('T')[0];
                if (!log[completedDate]) {
                    log[completedDate] = [];
                }
                // Avoid duplicates
                if (!log[completedDate].some(entry => entry.id === item.id)) {
                    log[completedDate].push({ id: item.id, text: item.text });
                }
            } 
            // If the item was just un-completed
            else if (!item.completed && wasCompleted) {
                // Find the date it was completed on to remove it from the log
                const completedDate = new Date(item.completedAt).toISOString().split('T')[0];
                if (log[completedDate]) {
                    log[completedDate] = log[completedDate].filter(entry => entry.id !== item.id);
                    // If the day's log is now empty, remove the date key
                    if (log[completedDate].length === 0) {
                        delete log[completedDate];
                    }
                }
            }
            localStorage.setItem('dailyBreachLog', JSON.stringify(log));
        }

        function renderBreachCompletionTable() {
            const container = document.getElementById('breach-log-container');
            const log = JSON.parse(localStorage.getItem('dailyBreachLog')) || {};
            
            container.innerHTML = ''; // Clear existing items

            const sortedDates = Object.keys(log).sort((a, b) => new Date(b) - new Date(a));

            if (sortedDates.length === 0) {
                container.innerHTML = `<p class="text-center p-4 text-slate-500">No completed items recorded yet.</p>`;
                return;
            }

            sortedDates.forEach(date => {
                const items = log[date];
                if (items.length > 0) {
                    const detailsEl = document.createElement('details');
                    detailsEl.className = 'bg-slate-50 dark:bg-gray-700/50 rounded-lg';

                    let listItemsHTML = '';
                    items.forEach(item => {
                        listItemsHTML += `<li class="text-slate-600 dark:text-slate-300">${item.text}</li>`;
                    });

                    detailsEl.innerHTML = `
                        <summary class="p-4 flex justify-between items-center font-semibold text-slate-800 dark:text-white">
                            <span>${date}</span>
                            <div class="flex items-center gap-x-2">
                                <span class="text-sm px-2 py-1 bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300 rounded-md">${items.length} completed</span>
                                <svg class="w-5 h-5 summary-arrow text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        </summary>
                        <div class="p-4 border-t border-slate-200 dark:border-gray-600">
                            <ul class="list-disc list-inside space-y-2">
                                ${listItemsHTML}
                            </ul>
                        </div>
                    `;
                    container.appendChild(detailsEl);
                }
            });
        }

        function renderBreachStats() {
            const breachItems = JSON.parse(localStorage.getItem('breachItems')) || [];
            const total = breachItems.length;
            const completed = breachItems.filter(item => item.completed).length;
            const pending = total - completed;
            const percentage = total > 0 ? (completed / total) * 100 : 0;

            document.getElementById('breach-stats-total').textContent = total;
            document.getElementById('breach-stats-completed').textContent = completed;
            document.getElementById('breach-stats-pending').textContent = pending;
            document.getElementById('breach-stats-progress-bar').style.width = `${percentage}%`;
            document.getElementById('breach-stats-progress-percent').textContent = `${Math.round(percentage)}%`;
        }

        function renderDailyBreachProgress() {
            const log = JSON.parse(localStorage.getItem('dailyBreachLog')) || {};
            const today = new Date().toISOString().split('T')[0];
            const todaysCount = log[today] ? log[today].length : 0;
            const target = parseInt(localStorage.getItem('dailyBreachTarget')) || 20;
            const percentage = target > 0 ? (todaysCount / target) * 100 : 0;

            const progressBar = document.getElementById('daily-breach-progress-bar');
            const progressText = document.getElementById('daily-breach-progress-text');

            if (progressBar && progressText) {
                progressBar.style.width = `${Math.min(percentage, 100)}%`;
                progressText.textContent = `${todaysCount} / ${target}`;
            }
        }

        function setupBreachList() {
            const breachListPage = document.getElementById('breach-list');
            const itemInput = document.getElementById('breach-item-input');
            const addBtn = document.getElementById('add-breach-item-btn');
            const totalCountEl = document.getElementById('breach-total-count');
            const completedCountEl = document.getElementById('breach-completed-count');
            const uncompletedCountEl = document.getElementById('breach-uncompleted-count');
            const dailyTargetInput = document.getElementById('daily-target-input');
            const setDailyTargetBtn = document.getElementById('set-daily-target-btn');

            let breachItems = JSON.parse(localStorage.getItem('breachItems')) || [];
            
            if(dailyTargetInput) {
                dailyTargetInput.value = localStorage.getItem('dailyBreachTarget') || 20;
            }

            if(setDailyTargetBtn) {
                setDailyTargetBtn.addEventListener('click', () => {
                    const newTarget = parseInt(dailyTargetInput.value);
                    if (newTarget && newTarget > 0) {
                        localStorage.setItem('dailyBreachTarget', newTarget);
                        renderDailyBreachProgress();
                        showAlert('Daily target updated!');
                    } else {
                        showAlert('Please enter a valid number for the target.');
                    }
                });
            }


            function saveItems() {
                localStorage.setItem('breachItems', JSON.stringify(breachItems));
            }

            function updateCounters() {
                const total = breachItems.length;
                const completed = breachItems.filter(item => item.completed).length;
                const uncompleted = total - completed;

                totalCountEl.textContent = total;
                completedCountEl.textContent = completed;
                uncompletedCountEl.textContent = uncompleted;
            }

            function createBreachItemElement(item) {
                const itemEl = document.createElement('div');
                itemEl.className = 'breach-item';
                itemEl.dataset.id = item.id;

                const timestampHTML = item.createdAt 
                    ? `<div class="text-xs text-slate-400 dark:text-slate-500 mt-1">Created: ${new Date(item.createdAt).toLocaleString()}</div>` 
                    : '';

                itemEl.innerHTML = `
                    <input type="checkbox" id="breach-${item.id}" class="breach-item-checkbox hidden" ${item.completed ? 'checked' : ''}>
                    <label for="breach-${item.id}" class="flex items-center cursor-pointer text-slate-700 dark:text-slate-300 w-full">
                        <span class="w-5 h-5 mr-4 rounded border-2 border-slate-300 dark:border-gray-600 flex-shrink-0 flex items-center justify-center">
                            <svg class="w-3.5 h-3.5 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        </span>
                        <div class="flex-grow">
                            <span class="flex-grow">${item.text}</span>
                            ${timestampHTML}
                        </div>
                    </label>
                    <button class="delete-breach-item ml-4 text-slate-400 hover:text-red-500">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                `;
                return itemEl;
            }

            function renderList() {
                const uncompletedContainer = document.getElementById('breach-list-uncompleted-container');
                const completedContainer = document.getElementById('breach-list-completed-container');
                const completedSection = document.getElementById('breach-list-completed-section');
                const completedCountEl = document.getElementById('completed-tasks-count');

                // Clear the lists first
                uncompletedContainer.innerHTML = '';
                completedContainer.innerHTML = '';

                const completedItems = breachItems.filter(item => item.completed);
                const uncompletedItems = breachItems.filter(item => !item.completed);
                
                // Render uncompleted items
                if (uncompletedItems.length > 0) {
                     uncompletedItems.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(item => {
                        uncompletedContainer.appendChild(createBreachItemElement(item));
                    });
                } else {
                    uncompletedContainer.innerHTML = `<p class="text-center text-slate-500 dark:text-slate-400">All items completed! üéâ</p>`;
                }

                // Render completed items
                if (completedItems.length > 0) {
                    completedSection.classList.remove('hidden');
                    completedCountEl.textContent = completedItems.length;
                    completedItems
                        .sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt))
                        .forEach(item => {
                            completedContainer.appendChild(createBreachItemElement(item));
                        });
                } else {
                    completedSection.classList.add('hidden');
                }

                updateCounters();
            }

            addBtn.addEventListener('click', () => {
                const text = itemInput.value.trim();
                if (text) {
                    breachItems.push({
                        id: Date.now(),
                        text: text,
                        completed: false,
                        createdAt: new Date().toISOString()
                    });
                    itemInput.value = '';
                    saveItems();
                    renderList();
                    renderBreachStats();
                }
            });
            
            itemInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addBtn.click();
                }
            });

            breachListPage.addEventListener('click', (e) => {
                const targetLabel = e.target.closest('label');
                const deleteBtn = e.target.closest('.delete-breach-item');

                if (targetLabel) {
                    const checkboxId = targetLabel.getAttribute('for');
                    const checkbox = document.getElementById(checkboxId);
                    const itemId = checkbox.closest('.breach-item').dataset.id;
                    const item = breachItems.find(i => i.id == itemId);
                    
                    const wasCompleted = item.completed;
                    item.completed = !checkbox.checked; 

                    if (item.completed && !wasCompleted) {
                        item.completedAt = new Date().toISOString();
                    }
                    
                    updateBreachLog(item, wasCompleted);
                    
                    if (!item.completed) {
                        delete item.completedAt;
                    }

                    saveItems();
                    renderList();
                    renderBreachCompletionTable();
                    renderBreachStats();
                    renderDailyBreachProgress();
                }

                if (deleteBtn) {
                    const itemId = deleteBtn.closest('.breach-item').dataset.id;
                    const item = breachItems.find(i => i.id == itemId);
                    
                    if (item && item.completed) {
                        // This logic ensures the log is correctly updated when a completed item is deleted.
                        const tempUncompletedItem = { ...item, completed: false };
                        updateBreachLog(tempUncompletedItem, true);
                    }

                    breachItems = breachItems.filter(i => i.id != itemId);
                    saveItems();
                    renderList();
                    renderBreachCompletionTable();
                    renderBreachStats();
                    renderDailyBreachProgress();
                }
            });

            // Initial render
            renderList();
            renderDailyBreachProgress();
        }

        function setupDailyQuote() {
            const quoteTextEl = document.getElementById('quote-text');
            const quoteAuthorEl = document.getElementById('quote-author');

            const quotes = [
                { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
                { text: "The best way to predict the future is to create it.", author: "Peter Drucker" },
                { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
                { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
                { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
                { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
                { text: "Your time is limited, don't waste it living someone else's life.", author: "Steve Jobs" },
                { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
                { text: "It does not matter how slowly you go as long as you do not stop.", author: "Confucius" },
                { text: "The journey of a thousand miles begins with a single step.", author: "Lao Tzu" }
            ];

            function getDailyQuote() {
                const today = new Date().toISOString().split('T')[0];
                const storedQuoteData = JSON.parse(localStorage.getItem('dailyQuote'));

                if (storedQuoteData && storedQuoteData.date === today) {
                    quoteTextEl.textContent = `"${storedQuoteData.quote.text}"`;
                    quoteAuthorEl.textContent = `- ${storedQuoteData.quote.author}`;
                } else {
                    const randomIndex = Math.floor(Math.random() * quotes.length);
                    const newQuote = quotes[randomIndex];
                    
                    localStorage.setItem('dailyQuote', JSON.stringify({
                        date: today,
                        quote: newQuote
                    }));
                    
                    quoteTextEl.textContent = `"${newQuote.text}"`;
                    quoteAuthorEl.textContent = `- ${newQuote.author}`;
                }
            }

            getDailyQuote();
        }

        function setupTimeAndWeather() {
            const timeEl = document.getElementById('time-display');
            const dateEl = document.getElementById('date-display');
            const weatherEl = document.getElementById('weather-display');

            function updateTime() {
                const now = new Date();
                timeEl.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                dateEl.textContent = now.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            }

            async function fetchWeather() {
                try {
                    const response = await fetch('https://wttr.in/Liverpool?format=j1');
                    const data = await response.json();
                    const condition = data.current_condition[0];
                    
                    weatherEl.innerHTML = `
                        <div class="text-3xl">${getWeatherIcon(condition.weatherCode)}</div>
                        <div>
                            <p class="font-semibold text-xl">${condition.temp_C}¬∞C</p>
                            <p class="text-xs text-slate-500 dark:text-slate-400">${condition.weatherDesc[0].value}</p>
                        </div>
                    `;
                } catch (error) {
                    weatherEl.innerHTML = `<p class="text-sm text-red-500">Could not fetch weather.</p>`;
                    console.error("Error fetching weather:", error);
                }
            }

            function getWeatherIcon(code) {
                if (code >= 200 && code < 300) return '‚õàÔ∏è'; // Thunderstorm
                if (code >= 300 && code < 400) return 'üåßÔ∏è'; // Drizzle
                if (code >= 500 && code < 600) return 'üåßÔ∏è'; // Rain
                if (code >= 600 && code < 700) return '‚ùÑÔ∏è'; // Snow
                if (code >= 700 && code < 800) return 'üå´Ô∏è'; // Atmosphere
                if (code === 800) return '‚òÄÔ∏è'; // Clear
                if (code === 801) return 'üå§Ô∏è'; // Few clouds
                if (code === 802) return '‚õÖÔ∏è'; // Scattered clouds
                if (code === 803 || code === 804) return '‚òÅÔ∏è'; // Broken/overcast clouds
                return 'üåç'; // Default
            }

            updateTime();
            setInterval(updateTime, 1000);
            fetchWeather();
            setInterval(fetchWeather, 900000); // every 15 minutes
        }

        function setupSalaryCalculator() {
            const calculateBtn = document.getElementById('calculate-salary-btn');
            const grossIncomeInput = document.getElementById('gross-income');
            const taxCodeInput = document.getElementById('tax-code');
            const resultsDiv = document.getElementById('salary-results');
            const incomeTypeRadios = document.querySelectorAll('input[name="income-type"]');

            const formatCurrency = (value) => `¬£${value.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,')}`;

            calculateBtn.addEventListener('click', () => {
                const incomeType = document.querySelector('input[name="income-type"]:checked').value;
                let grossIncome = parseFloat(grossIncomeInput.value);
                const taxCode = taxCodeInput.value.toUpperCase();

                if (isNaN(grossIncome) || grossIncome <= 0) {
                    showAlert("Please enter a valid gross income.");
                    return;
                }

                if (incomeType === 'monthly') {
                    grossIncome *= 12;
                }
                
                // --- Tax Code & Personal Allowance ---
                let personalAllowance = 0;
                const taxCodeMatch = taxCode.match(/(\d+)/);
                if (taxCodeMatch) {
                    personalAllowance = parseInt(taxCodeMatch[1]) * 10;
                }
                
                // Taper personal allowance for high earners
                if (grossIncome > 100000) {
                    const reduction = Math.floor((grossIncome - 100000) / 2);
                    personalAllowance = Math.max(0, personalAllowance - reduction);
                }

                const taxableIncome = Math.max(0, grossIncome - personalAllowance);

                // --- Income Tax Calculation (England/Wales/NI 2024/25) ---
                let incomeTax = 0;
                const basicRateLimit = 37700;
                const higherRateLimit = 125140 - personalAllowance;
                
                if (taxableIncome > 0) {
                    // Basic Rate
                    const basicTaxable = Math.min(taxableIncome, basicRateLimit);
                    incomeTax += basicTaxable * 0.20;

                    // Higher Rate
                    if (taxableIncome > basicRateLimit) {
                        const higherTaxable = Math.min(taxableIncome - basicRateLimit, higherRateLimit - basicRateLimit);
                        incomeTax += higherTaxable * 0.40;
                    }

                    // Additional Rate
                    if (taxableIncome > higherRateLimit) {
                        const additionalTaxable = taxableIncome - higherRateLimit;
                        incomeTax += additionalTaxable * 0.45;
                    }
                }

                // --- National Insurance Calculation (Class 1, 2024/25) ---
                let nationalInsurance = 0;
                const niLowerThreshold = 12570;
                const niUpperThreshold = 50270;

                if (grossIncome > niLowerThreshold) {
                    // 8% bracket
                    const niBand1 = Math.min(grossIncome, niUpperThreshold) - niLowerThreshold;
                    nationalInsurance += Math.max(0, niBand1) * 0.08;
                    
                    // 2% bracket
                    if (grossIncome > niUpperThreshold) {
                        const niBand2 = grossIncome - niUpperThreshold;
                        nationalInsurance += niBand2 * 0.02;
                    }
                }

                const netIncome = grossIncome - incomeTax - nationalInsurance;

                // --- Display Results ---
                // Annual
                document.getElementById('annual-net').textContent = formatCurrency(netIncome);
                document.getElementById('annual-gross').textContent = formatCurrency(grossIncome);
                document.getElementById('annual-allowance').textContent = formatCurrency(personalAllowance);
                document.getElementById('annual-taxable').textContent = formatCurrency(taxableIncome);
                document.getElementById('annual-tax').textContent = `- ${formatCurrency(incomeTax)}`;
                document.getElementById('annual-ni').textContent = `- ${formatCurrency(nationalInsurance)}`;
                
                // Monthly
                document.getElementById('monthly-net').textContent = formatCurrency(netIncome / 12);
                document.getElementById('monthly-gross').textContent = formatCurrency(grossIncome / 12);
                document.getElementById('monthly-allowance').textContent = formatCurrency(personalAllowance / 12);
                document.getElementById('monthly-taxable').textContent = formatCurrency(taxableIncome / 12);
                document.getElementById('monthly-tax').textContent = `- ${formatCurrency(incomeTax / 12)}`;
                document.getElementById('monthly-ni').textContent = `- ${formatCurrency(nationalInsurance / 12)}`;

                resultsDiv.classList.remove('hidden');
            });
        }

        function setupOvertimeTracker() {
            const addBtn = document.getElementById('add-overtime-btn');
            const listContainer = document.getElementById('overtime-list');
            const totalsContainer = document.getElementById('overtime-fund-totals');
            
            const allocationSelect = document.getElementById('overtime-allocation');
            const customAllocationInput = document.getElementById('overtime-allocation-custom');

            const editModal = document.getElementById('overtime-edit-modal');
            const cancelEditBtn = document.getElementById('cancel-edit-overtime-btn');
            const saveEditBtn = document.getElementById('save-edit-overtime-btn');
            const editAllocationSelect = document.getElementById('edit-overtime-allocation');
            const editCustomAllocationInput = document.getElementById('edit-overtime-allocation-custom');


            let overtimeEntries = JSON.parse(localStorage.getItem('overtimeEntries')) || [];
            const formatCurrency = (value) => `¬£${value.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,')}`;

            function saveEntries() {
                localStorage.setItem('overtimeEntries', JSON.stringify(overtimeEntries));
            }

            function updateTotals() {
                totalsContainer.innerHTML = '';
                const totals = overtimeEntries.reduce((acc, entry) => {
                    const allocation = entry.allocation;
                    acc[allocation] = (acc[allocation] || 0) + entry.amount;
                    return acc;
                }, {});

                const fundColors = {
                    'Holiday': 'blue',
                    'Savings': 'purple',
                };

                Object.keys(totals).sort().forEach(key => {
                    const color = fundColors[key] || 'gray';
                    const totalEl = document.createElement('div');
                    totalEl.className = `bg-${color}-100 dark:bg-${color}-900/50 p-4 rounded-lg text-center`;
                    totalEl.innerHTML = `
                        <p class="text-sm text-${color}-800 dark:text-${color}-300">${key} Fund</p>
                        <p class="text-2xl font-bold text-${color}-900 dark:text-${color}-200">${formatCurrency(totals[key])}</p>
                    `;
                    totalsContainer.appendChild(totalEl);
                });
            }

            function renderEntries() {
                listContainer.innerHTML = '';

                const groupedByMonth = overtimeEntries.reduce((acc, entry) => {
                    const month = new Date(entry.date).toLocaleString('default', { month: 'long', year: 'numeric' });
                    if (!acc[month]) {
                        acc[month] = [];
                    }
                    acc[month].push(entry);
                    return acc;
                }, {});

                const sortedMonths = Object.keys(groupedByMonth).sort((a, b) => new Date(b) - new Date(a));

                if (sortedMonths.length === 0) {
                    listContainer.innerHTML = `<p class="text-center text-slate-500 dark:text-slate-400">No overtime logged yet.</p>`;
                    updateTotals();
                    return;
                }

                sortedMonths.forEach(month => {
                    const monthContainer = document.createElement('div');
                    monthContainer.innerHTML = `<h3 class="text-lg font-semibold text-slate-700 dark:text-slate-300 mb-2">${month}</h3>`;
                    
                    const groupedByAllocation = groupedByMonth[month].reduce((acc, entry) => {
                        if (!acc[entry.allocation]) {
                            acc[entry.allocation] = [];
                        }
                        acc[entry.allocation].push(entry);
                        return acc;
                    }, {});

                    Object.keys(groupedByAllocation).sort().forEach(allocation => {
                        const allocationTotal = groupedByAllocation[allocation].reduce((sum, item) => sum + item.amount, 0);
                        const allocationContainer = document.createElement('div');
                        allocationContainer.className = 'mb-4';
                        allocationContainer.innerHTML = `
                            <div class="flex justify-between items-center bg-slate-100 dark:bg-gray-700/60 p-2 rounded-t-lg">
                                <h4 class="font-semibold text-slate-800 dark:text-slate-200">${allocation}</h4>
                                <span class="font-bold text-slate-800 dark:text-slate-200">${formatCurrency(allocationTotal)}</span>
                            </div>
                        `;
                        
                        const entriesList = document.createElement('div');
                        entriesList.className = 'border border-t-0 dark:border-gray-700 rounded-b-lg';

                        groupedByAllocation[allocation].sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(entry => {
                            const entryEl = document.createElement('div');
                            entryEl.className = 'grid grid-cols-4 gap-4 items-center p-3 border-b dark:border-gray-700 last:border-b-0';
                            entryEl.dataset.id = entry.id;
                            entryEl.innerHTML = `
                                <div class="text-slate-800 dark:text-slate-200">${new Date(entry.date).toLocaleDateString()}</div>
                                <div class="text-sm text-slate-600 dark:text-slate-400">${entry.hours} hrs @ ${formatCurrency(entry.rate)}/hr</div>
                                <div class="font-semibold text-slate-900 dark:text-white">${formatCurrency(entry.amount)}</div>
                                <div class="flex justify-end gap-2">
                                    <button class="edit-overtime-btn p-1 text-slate-500 hover:text-indigo-600 dark:hover:text-indigo-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    </button>
                                    <button class="delete-overtime-btn p-1 text-slate-500 hover:text-red-600 dark:hover:text-red-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                    </button>
                                </div>
                            `;
                            entriesList.appendChild(entryEl);
                        });
                        allocationContainer.appendChild(entriesList);
                        monthContainer.appendChild(allocationContainer);
                    });

                    listContainer.appendChild(monthContainer);
                });

                updateTotals();
            }

            allocationSelect.addEventListener('change', () => {
                customAllocationInput.classList.toggle('hidden', allocationSelect.value !== 'Other');
            });
            editAllocationSelect.addEventListener('change', () => {
                editCustomAllocationInput.classList.toggle('hidden', editAllocationSelect.value !== 'Other');
            });

            addBtn.addEventListener('click', () => {
                const date = document.getElementById('overtime-date').value;
                const hours = parseFloat(document.getElementById('overtime-hours').value);
                const rate = parseFloat(document.getElementById('overtime-rate').value);
                let allocation = allocationSelect.value;

                if (allocation === 'Other') {
                    allocation = customAllocationInput.value.trim();
                    if (!allocation) {
                        showAlert("Please enter a name for your custom allocation.");
                        return;
                    }
                }
                
                if (!date || isNaN(hours) || hours <= 0 || isNaN(rate) || rate <= 0) {
                    showAlert("Please enter a valid date, hours, and rate.");
                    return;
                }
                
                const amount = hours * rate;

                overtimeEntries.push({ id: Date.now(), date, hours, rate, amount, allocation });
                saveEntries();
                renderEntries();
                
                document.getElementById('overtime-date').value = '';
                document.getElementById('overtime-hours').value = '';
                document.getElementById('overtime-rate').value = '';
                customAllocationInput.value = '';
                allocationSelect.value = 'Savings';
                customAllocationInput.classList.add('hidden');
            });

            listContainer.addEventListener('click', (e) => {
                const editBtn = e.target.closest('.edit-overtime-btn');
                const deleteBtn = e.target.closest('.delete-overtime-btn');
                
                if (editBtn) {
                    const entryEl = editBtn.closest('.grid');
                    const entryId = parseInt(entryEl.dataset.id);
                    const entry = overtimeEntries.find(item => item.id === entryId);

                    document.getElementById('edit-overtime-id').value = entry.id;
                    document.getElementById('edit-overtime-date').value = entry.date;
                    document.getElementById('edit-overtime-hours').value = entry.hours;
                    document.getElementById('edit-overtime-rate').value = entry.rate;
                    
                    const standardOptions = ["Savings", "Holiday"];
                    if (standardOptions.includes(entry.allocation)) {
                        editAllocationSelect.value = entry.allocation;
                        editCustomAllocationInput.classList.add('hidden');
                        editCustomAllocationInput.value = '';
                    } else {
                        editAllocationSelect.value = 'Other';
                        editCustomAllocationInput.classList.remove('hidden');
                        editCustomAllocationInput.value = entry.allocation;
                    }
                    
                    editModal.classList.remove('hidden');
                    editModal.classList.add('flex');
                }

                if (deleteBtn) {
                    const entryEl = deleteBtn.closest('.grid');
                    const entryId = parseInt(entryEl.dataset.id);
                    overtimeEntries = overtimeEntries.filter(item => item.id !== entryId);
                    saveEntries();
                    renderEntries();
                }
            });

            function closeEditModal() {
                editModal.classList.add('hidden');
                editModal.classList.remove('flex');
            }

            cancelEditBtn.addEventListener('click', closeEditModal);

            saveEditBtn.addEventListener('click', () => {
                const id = parseInt(document.getElementById('edit-overtime-id').value);
                const date = document.getElementById('edit-overtime-date').value;
                const hours = parseFloat(document.getElementById('edit-overtime-hours').value);
                const rate = parseFloat(document.getElementById('edit-overtime-rate').value);
                let allocation = editAllocationSelect.value;
                
                if (allocation === 'Other') {
                    allocation = editCustomAllocationInput.value.trim();
                    if (!allocation) {
                        showAlert("Please enter a name for your custom allocation.");
                        return;
                    }
                }

                if (!date || isNaN(hours) || hours <= 0 || isNaN(rate) || rate <= 0) {
                    showAlert("Please enter valid details.");
                    return;
                }

                const amount = hours * rate;

                const entryIndex = overtimeEntries.findIndex(item => item.id === id);
                if (entryIndex > -1) {
                    overtimeEntries[entryIndex] = { id, date, hours, rate, amount, allocation };
                    saveEntries();
                    renderEntries();
                    closeEditModal();
                }
            });

            renderEntries();
        }

        function setupBallGame() {
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const startGameBtn = document.getElementById('start-game-btn');
            const resetGameBtn = document.getElementById('reset-game-btn');
            const scoreDisplay = document.getElementById('game-score');
            const livesDisplay = document.getElementById('game-lives');
            const highScoreDisplay = document.getElementById('game-high-score');

            // Game variables
            let gameInterval;
            let gameRunning = false;
            let score = 0;
            let lives = 3;
            let highScore = localStorage.getItem('ballGameHighScore') || 0;

            // Ball properties
            let ballRadius = 10;
            let x = canvas.width / 2;
            let y = canvas.height - 30;
            let dx = 2;
            let dy = -2;

            // Paddle properties
            let paddleHeight = 10;
            let paddleWidth = 75;
            let paddleX = (canvas.width - paddleWidth) / 2;
            let rightPressed = false;
            let leftPressed = false;

            // Event listeners for paddle control
            document.addEventListener("keydown", keyDownHandler, false);
            document.addEventListener("keyup", keyUpHandler, false);
            canvas.addEventListener("mousemove", mouseMoveHandler, false);

            function keyDownHandler(e) {
                if(e.key === "Right" || e.key === "ArrowRight") {
                    rightPressed = true;
                }
                else if(e.key === "Left" || e.key === "ArrowLeft") {
                    leftPressed = true;
                }
            }

            function keyUpHandler(e) {
                if(e.key === "Right" || e.key === "ArrowRight") {
                    rightPressed = false;
                }
                else if(e.key === "Left" || e.key === "ArrowLeft") {
                    leftPressed = false;
                }
            }

            function mouseMoveHandler(e) {
                let relativeX = e.clientX - canvas.offsetLeft;
                if(relativeX > 0 && relativeX < canvas.width) {
                    paddleX = relativeX - paddleWidth / 2;
                }
            }

            // Drawing functions
            function drawBall() {
                ctx.beginPath();
                ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
                ctx.fillStyle = "#ffcc00"; // Yellow ball
                ctx.fill();
                ctx.closePath();
            }

            function drawPaddle() {
                ctx.beginPath();
                ctx.rect(paddleX, canvas.height - paddleHeight, paddleWidth, paddleHeight);
                ctx.fillStyle = "#8d8dff"; // Blue paddle
                ctx.fill();
                ctx.closePath();
            }

            function draw() {
                if (!gameRunning) return;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBall();
                drawPaddle();

                // Ball collision detection with walls
                if(x + dx > canvas.width - ballRadius || x + dx < ballRadius) {
                    dx = -dx;
                }
                if(y + dy < ballRadius) {
                    dy = -dy;
                } else if(y + dy > canvas.height - ballRadius) {
                    // Check for paddle collision
                    if(x > paddleX && x < paddleX + paddleWidth) {
                        dy = -dy;
                    } else {
                        lives--;
                        if(!lives) {
                            endGame();
                        } else {
                            // Reset ball position
                            x = canvas.width / 2;
                            y = canvas.height - 30;
                            dx = 2;
                            dy = -2;
                            paddleX = (canvas.width - paddleWidth) / 2;
                        }
                    }
                }

                // Paddle movement
                if(rightPressed && paddleX < canvas.width - paddleWidth) {
                    paddleX += 7;
                }
                else if(leftPressed && paddleX > 0) {
                    paddleX -= 7;
                }

                // Update ball position
                x += dx;
                y += dy;

                // Update score
                score++;
                scoreDisplay.textContent = `Score: ${score}`;

                requestAnimationFrame(draw);
            }

            function startGame() {
                if (gameRunning) return;
                gameRunning = true;
                score = 0;
                lives = 3;
                scoreDisplay.textContent = `Score: ${score}`;
                livesDisplay.textContent = `Lives: ${lives}`;
                highScoreDisplay.textContent = `High Score: ${highScore}`;
                gameInterval = requestAnimationFrame(draw);
                startGameBtn.textContent = "Pause";
            }

            function pauseGame() {
                if (!gameRunning) return;
                gameRunning = false;
                cancelAnimationFrame(gameInterval);
                startGameBtn.textContent = "Resume";
            }

            function resetGame() {
                pauseGame();
                x = canvas.width / 2;
                y = canvas.height - 30;
                dx = 2;
                dy = -2;
                paddleX = (canvas.width - paddleWidth) / 2;
                score = 0;
                lives = 3;
                scoreDisplay.textContent = `Score: ${score}`;
                livesDisplay.textContent = `Lives: ${lives}`;
                startGameBtn.textContent = "Start";
                drawBall();
                drawPaddle();
            }

            function endGame() {
                pauseGame();
                showAlert(`Game Over! Your score was ${score}.`);
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('ballGameHighScore', highScore);
                    highScoreDisplay.textContent = `High Score: ${highScore}`;
                }
                resetGame();
            }

            startGameBtn.addEventListener('click', () => {
                if (gameRunning) {
                    pauseGame();
                } else {
                    startGame();
                }
            });

            resetGameBtn.addEventListener('click', resetGame);
            
            // Initial draw to show the starting state
            drawBall();
            drawPaddle();
        }

    </script>
</body>
</html>
